<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Card Radiograf√≠a Financiera - Optimizada</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet"/>

<style>
  :root {
    --primary: #4f46e5;
    --ok: #10b981;
    --warn: #f59e0b;
    --bad: #ef4444;
    --bg: #f8fafc;
    --card: #ffffff;
    --text: #0f172a;
    --muted: #64748b;
    --border: #e2e8f0;
  }
  
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  html {
    -webkit-text-size-adjust: 100%;
    -webkit-tap-highlight-color: transparent;
  }
  
  body {
    font-family: 'Inter', system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    padding: 40px 20px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  .demo-container {
    max-width: 1440px;
    margin: 0 auto;
  }
  
  .demo-header {
    text-align: center;
    margin-bottom: 40px;
  }
  
  .demo-header h1 {
    font-size: 28px;
    font-weight: 900;
    margin-bottom: 12px;
    background: linear-gradient(135deg, var(--primary), #7c3aed);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  
  .demo-header p {
    color: var(--muted);
    font-size: 15px;
  }
  
  /* Simular el layout del tablero real */
  .dashboard-layout {
    display: grid;
    grid-template-columns: 290px 1fr;
    gap: 0;
    margin-bottom: 32px;
  }
  
  .sidebar-mock {
    background: linear-gradient(135deg, #1e293b, #0f172a);
    height: 600px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 700;
  }
  
  .main-mock {
    padding: 0 28px;
  }
  
  .cards-grid {
    display: grid;
    grid-template-columns: 1.45fr 0.95fr;
    gap: 24px;
  }
  
  /* FINANCIAL HEALTH CARD - Optimizada para 660-680px */
  .financial-health-card {
    background: white;
    border-radius: 16px;
    padding: 28px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    min-height: 420px;
    display: flex;
    flex-direction: column;
    transition: all 0.3s ease;
  }
  
  .financial-health-card:hover {
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    transform: translateY(-2px);
  }
  
  /* CARD STATES */
  .card-state {
    display: none;
  }
  
  .card-state.active {
    display: flex;
    flex-direction: column;
    flex: 1;
  }
  
  /* INITIAL STATE */
  .initial-state {
    text-align: center;
    align-items: center;
    justify-content: center;
    gap: 4px;
  }
  
  .icon-container {
    margin-bottom: 16px;
  }
  
  .large-icon {
    font-size: 56px;
    display: block;
    animation: float 3s ease-in-out infinite;
  }
  
  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-8px); }
  }
  
  .initial-state h3 {
    font-size: 22px;
    font-weight: 800;
    margin-bottom: 6px;
    color: #0f172a;
  }
  
  .initial-state > p {
    font-size: 14px;
    color: #64748b;
    margin-bottom: 20px;
  }
  
  .small-text {
    font-size: 12px !important;
    margin-top: 10px !important;
    margin-bottom: 0 !important;
    color: #94a3b8 !important;
  }
  
  /* INCOMPLETE STATE */
  .incomplete-state {
    text-align: center;
    align-items: center;
    justify-content: center;
    gap: 4px;
  }
  
  .incomplete-state h3 {
    font-size: 22px;
    font-weight: 800;
    margin-bottom: 6px;
    color: #0f172a;
  }
  
  .incomplete-state > p {
    font-size: 14px;
    color: #64748b;
    margin-bottom: 16px;
  }
  
  .progress-ring {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    background: linear-gradient(135deg, #fef3c7, #fde68a);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 16px 0;
    border: 4px solid #fbbf24;
  }
  
  .progress-value {
    font-size: 26px;
    font-weight: 900;
    color: #92400e;
  }
  
  /* COMPLETED STATE */
  .completed-state {
    gap: 18px;
  }
  
  .stage-header {
    padding: 18px;
    border-radius: 12px;
    color: white;
    display: flex;
    align-items: center;
    gap: 14px;
  }
  
  .stage-icon {
    font-size: 40px;
    line-height: 1;
  }
  
  .stage-info {
    flex: 1;
  }
  
  .stage-info h3 {
    font-size: 17px;
    font-weight: 800;
    margin-bottom: 10px;
    line-height: 1.3;
  }
  
  .progress-bar {
    height: 7px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 999px;
    overflow: hidden;
    margin-bottom: 6px;
  }
  
  .progress-fill {
    height: 100%;
    background: white;
    transition: width 0.5s ease;
    border-radius: 999px;
  }
  
  .progress-label {
    font-size: 12px;
    font-weight: 600;
    opacity: 0.95;
  }
  
  /* ISSUES CHECKLIST */
  .issues-checklist {
    background: #f8fafc;
    border-radius: 12px;
    padding: 18px;
    flex: 1;
    overflow-y: auto;
    max-height: 240px;
  }
  
  .issues-checklist h4 {
    font-size: 15px;
    font-weight: 800;
    margin-bottom: 14px;
    color: #0f172a;
  }
  
  .issues-checklist ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  
  .issues-checklist li {
    display: flex;
    align-items: flex-start;
  }
  
  .issues-checklist label {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    cursor: pointer;
    width: 100%;
  }
  
  .issues-checklist input[type="checkbox"] {
    display: none;
  }
  
  .checkbox-custom {
    width: 18px;
    height: 18px;
    min-width: 18px;
    border: 2px solid #cbd5e1;
    border-radius: 5px;
    background: white;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 2px;
  }
  
  .issues-checklist input[type="checkbox"]:checked + .checkbox-custom {
    background: linear-gradient(135deg, #10b981, #059669);
    border-color: #10b981;
  }
  
  .issues-checklist input[type="checkbox"]:checked + .checkbox-custom::after {
    content: '‚úì';
    color: white;
    font-weight: 900;
    font-size: 12px;
  }
  
  .issue-text {
    font-size: 13px;
    font-weight: 600;
    color: #475569;
    line-height: 1.5;
    flex: 1;
  }
  
  .issues-checklist li.checked .issue-text {
    text-decoration: line-through;
    opacity: 0.6;
  }
  
  .no-issues {
    text-align: center;
    padding: 20px;
    color: #10b981;
    font-weight: 600;
    font-size: 14px;
  }
  
  /* BUTTONS */
  .cta-button {
    padding: 14px 24px;
    border: none;
    border-radius: 12px;
    background: linear-gradient(135deg, #4f46e5, #7c3aed);
    color: white;
    font-family: inherit;
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
  }
  
  .cta-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(79, 70, 229, 0.3);
  }
  
  .cta-button.secondary {
    background: linear-gradient(135deg, #f59e0b, #d97706);
  }
  
  .cta-button.secondary:hover {
    box-shadow: 0 8px 20px rgba(245, 158, 11, 0.3);
  }
  
  .cta-button.outlined {
    background: white;
    color: #4f46e5;
    border: 2px solid #e2e8f0;
  }
  
  .cta-button.outlined:hover {
    background: #f8fafc;
    border-color: #4f46e5;
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.15);
  }
  
  .arrow {
    font-size: 16px;
    font-weight: 900;
  }
  
  /* PLACEHOLDER SECOND CARD */
  .placeholder-card {
    background: white;
    border-radius: 16px;
    padding: 28px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    min-height: 420px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--muted);
    font-weight: 600;
    font-size: 14px;
  }
  
  /* MODAL */
  .modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.75);
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
    backdrop-filter: blur(4px);
    animation: fadeIn 0.2s ease;
  }
  
  .modal-overlay.show {
    display: flex;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  .modal-content {
    background: white;
    border-radius: 20px;
    width: 100%;
    max-width: 680px;
    max-height: 90vh;
    overflow: hidden;
    position: relative;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.3s ease;
  }
  
  @keyframes slideUp {
    from { 
      opacity: 0;
      transform: translateY(30px);
    }
    to { 
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .modal-close {
    position: absolute;
    top: 16px;
    right: 16px;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: none;
    background: rgba(0, 0, 0, 0.1);
    color: #64748b;
    font-size: 20px;
    cursor: pointer;
    z-index: 10;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .modal-close:hover {
    background: rgba(0, 0, 0, 0.2);
    color: #0f172a;
  }
  
  .modal-inner {
    width: 100%;
    height: 90vh;
    max-height: 700px;
    overflow-y: auto;
    padding: 60px 40px 40px 40px;
  }
  
  /* DEMO CONTROLS */
  .demo-controls {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-top: 32px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  }
  
  .demo-controls h3 {
    font-size: 16px;
    font-weight: 800;
    margin-bottom: 16px;
  }
  
  .demo-controls button {
    padding: 10px 16px;
    border-radius: 8px;
    border: 2px solid #e2e8f0;
    background: white;
    font-family: inherit;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    margin-right: 8px;
    margin-bottom: 8px;
    transition: all 0.2s ease;
  }
  
  .demo-controls button:hover {
    background: #f8fafc;
    border-color: var(--primary);
  }
  
  .size-indicator {
    background: linear-gradient(135deg, #e0f2fe, #bae6fd);
    border: 2px solid #0ea5e9;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 24px;
    text-align: center;
  }
  
  .size-indicator h3 {
    font-size: 14px;
    font-weight: 800;
    color: #0369a1;
    margin-bottom: 8px;
  }
  
  .size-indicator p {
    font-size: 13px;
    color: #0c4a6e;
    font-weight: 600;
  }
  
  /* STANDALONE CARDS FOR COMPARISON */
  .standalone-section {
    margin-top: 48px;
    padding-top: 48px;
    border-top: 2px dashed #e2e8f0;
  }
  
  .standalone-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(660px, 1fr));
    gap: 24px;
    max-width: 1400px;
    margin: 0 auto;
  }
  
  /* RESPONSIVE */
  @media (max-width: 1440px) {
    .dashboard-layout {
      grid-template-columns: 1fr;
    }
    
    .sidebar-mock {
      display: none;
    }
    
    .main-mock {
      padding: 0;
    }
  }
  
  @media (max-width: 768px) {
    .cards-grid {
      grid-template-columns: 1fr;
    }
    
    .standalone-grid {
      grid-template-columns: 1fr;
    }
    
    .financial-health-card {
      padding: 24px;
    }
    
    .large-icon {
      font-size: 48px;
    }
    
    .initial-state h3,
    .incomplete-state h3 {
      font-size: 20px;
    }
    
    .stage-header {
      flex-direction: column;
      text-align: center;
      gap: 12px;
    }
    
    .stage-icon {
      font-size: 36px;
    }
    
    .stage-info h3 {
      font-size: 16px;
    }
    
    .modal-overlay {
      padding: 0;
    }
    
    .modal-content {
      max-width: 100%;
      max-height: 100vh;
      border-radius: 0;
    }
    
    .modal-inner {
      height: 100vh;
      max-height: 100vh;
      padding: 60px 20px 20px 20px;
    }
  }
</style>
</head>

<body>
  <div class="demo-container">
    <div class="demo-header">
      <h1>Card Radiograf√≠a Financiera</h1>
      <p>Optimizada para tablero (660-680px de ancho)</p>
    </div>

    <div class="size-indicator">
      <h3>üìê Especificaciones del Layout</h3>
      <p>Viewport: 1440px | Sidebar: 290px | Grid: 1.45fr + 0.95fr | Card width: ~660-680px</p>
    </div>

    <!-- Simulaci√≥n del layout real del tablero -->
    <div class="dashboard-layout">
      <div class="sidebar-mock">Sidebar<br>290px</div>
      <div class="main-mock">
        <div class="cards-grid">
          <!-- CARD PRINCIPAL - Radiograf√≠a Financiera -->
          <div class="financial-health-card" id="mainCard">
            <div class="card-state initial-state active">
              <div class="icon-container">
                <span class="large-icon">üìä</span>
              </div>
              <h3>Radiograf√≠a Financiera</h3>
              <p>Descubre en qu√© etapa financiera te encuentras</p>
              <button class="cta-button" onclick="openModal()">
                <span>Hacer radiograf√≠a</span>
                <span class="arrow">‚Üí</span>
              </button>
              <p class="small-text">Solo toma 3-4 minutos</p>
            </div>
          </div>

          <!-- SEGUNDA CARD (Placeholder) -->
          <div class="placeholder-card">
            Segunda card del tablero<br>(0.95fr)
          </div>
        </div>
      </div>
    </div>

    <!-- Demo Controls -->
    <div class="demo-controls">
      <h3>üéÆ Controles de Demostraci√≥n</h3>
      <button onclick="resetCardToInitial()">üìä Estado Inicial</button>
      <button onclick="simulateIncomplete()">‚è≥ Incompleto (42%)</button>
      <button onclick="simulateCompleted(1)">üÜò Etapa 1</button>
      <button onclick="simulateCompleted(2)">üõ°Ô∏è Etapa 2</button>
      <button onclick="simulateCompleted(3)">üí∞ Etapa 3</button>
      <button onclick="simulateCompleted(4)">üü© Etapa 4</button>
      <button onclick="simulateCompleted(5)">üü¶ Etapa 5</button>
      <button onclick="clearAllData()" style="border-color: #ef4444; color: #ef4444;">üóëÔ∏è Limpiar</button>
    </div>

    <!-- Secci√≥n standalone para ver cada estado aislado -->
    <div class="standalone-section">
      <div class="demo-header" style="margin-bottom: 24px;">
        <h1 style="font-size: 24px;">Estados Aislados (Referencia)</h1>
        <p>Cada estado del card mostrado individualmente</p>
      </div>

      <div class="standalone-grid">
        <!-- Estado Inicial -->
        <div class="financial-health-card">
          <div class="card-state initial-state active">
            <div class="icon-container">
              <span class="large-icon">üìä</span>
            </div>
            <h3>Radiograf√≠a Financiera</h3>
            <p>Descubre en qu√© etapa financiera te encuentras</p>
            <button class="cta-button" onclick="openModal()">
              <span>Hacer radiograf√≠a</span>
              <span class="arrow">‚Üí</span>
            </button>
            <p class="small-text">Solo toma 3-4 minutos</p>
          </div>
        </div>

        <!-- Estado Incompleto -->
        <div class="financial-health-card">
          <div class="card-state incomplete-state active">
            <div class="icon-container">
              <span class="large-icon">‚è≥</span>
            </div>
            <h3>Radiograf√≠a Incompleta</h3>
            <p>Est√°s a mitad del camino</p>
            <div class="progress-ring">
              <div class="progress-value">42%</div>
            </div>
            <button class="cta-button secondary" onclick="openModal()">
              <span>Continuar radiograf√≠a</span>
              <span class="arrow">‚Üí</span>
            </button>
          </div>
        </div>

        <!-- Estado Completado -->
        <div class="financial-health-card">
          <div class="card-state completed-state active">
            <div class="stage-header" style="background: linear-gradient(135deg, #f59e0b, #d97706)">
              <span class="stage-icon">üõ°Ô∏è</span>
              <div class="stage-info">
                <h3>Etapa 2: Seguridad</h3>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 65%"></div>
                </div>
                <span class="progress-label">65% de progreso</span>
              </div>
            </div>

            <div class="issues-checklist">
              <h4>√Åreas por mejorar</h4>
              <ul>
                <li>
                  <label>
                    <input type="checkbox" onchange="toggleDemoCheck(this)">
                    <span class="checkbox-custom"></span>
                    <span class="issue-text">Tu reserva ideal es 9 meses (tienes 3)</span>
                  </label>
                </li>
                <li>
                  <label>
                    <input type="checkbox" onchange="toggleDemoCheck(this)">
                    <span class="checkbox-custom"></span>
                    <span class="issue-text">Nivel de deuda todav√≠a alto (>30% del ingreso)</span>
                  </label>
                </li>
                <li class="checked">
                  <label>
                    <input type="checkbox" checked onchange="toggleDemoCheck(this)">
                    <span class="checkbox-custom"></span>
                    <span class="issue-text">Deber√≠as ahorrar al menos 15% mensual</span>
                  </label>
                </li>
                <li>
                  <label>
                    <input type="checkbox" onchange="toggleDemoCheck(this)">
                    <span class="checkbox-custom"></span>
                    <span class="issue-text">Seguro de Vida (tienes dependientes)</span>
                  </label>
                </li>
              </ul>
            </div>

            <button class="cta-button outlined" onclick="openModal()">
              <span>Actualizar radiograf√≠a</span>
              <span class="arrow">üîÑ</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL -->
  <div class="modal-overlay" id="modal">
    <div class="modal-content" onclick="event.stopPropagation()">
      <button class="modal-close" onclick="closeModal()">‚úï</button>
      <div class="modal-inner" id="questionnaireContainer">
        <!-- El cuestionario se cargar√° aqu√≠ -->
      </div>
    </div>
  </div>

<script>
// STAGE CONFIGURATIONS
const STAGES = {
  1: {
    icon: 'üÜò',
    name: 'Supervivencia',
    desc: 'Est√°s luchando para cubrir gastos b√°sicos',
    gradient: 'linear-gradient(135deg, #ef4444, #dc2626)',
    steps: [
      'Deja de usar cr√©dito para gastos del d√≠a a d√≠a',
      'Reduce gastos innecesarios al m√≠nimo',
      'Busca formas de aumentar ingresos',
      'Ahorra $100-200/mes como sea posible'
    ]
  },
  2: {
    icon: 'üõ°Ô∏è',
    name: 'Seguridad',
    desc: 'Tienes estabilidad b√°sica pero poca protecci√≥n',
    gradient: 'linear-gradient(135deg, #f59e0b, #d97706)',
    steps: [
      'Construye reserva de 6-9 meses de gastos',
      'Reduce tus deudas a menos del 30% del ingreso',
      'Ahorra m√≠nimo 15% de tu ingreso',
      'Consigue seguros b√°sicos (vida, salud)'
    ]
  },
  3: {
    icon: 'üí∞',
    name: 'Acumulaci√≥n',
    desc: 'Est√°s construyendo riqueza consistentemente',
    gradient: 'linear-gradient(135deg, #3b82f6, #2563eb)',
    steps: [
      'Aumenta ahorro al 25-30% del ingreso',
      'Diversifica tus inversiones',
      'Construye patrimonio de 15√ó tu ingreso anual',
      'Empieza a generar ingresos pasivos'
    ]
  },
  4: {
    icon: 'üü©',
    name: 'Independencia',
    desc: 'Tus inversiones pueden mantener tu estilo de vida',
    gradient: 'linear-gradient(135deg, #10b981, #059669)',
    steps: [
      'Haz que tus ingresos pasivos cubran 100% de gastos',
      'Optimiza tu portafolio de inversiones',
      'Planifica protecci√≥n patrimonial',
      'Reduce deuda a menos del 10%'
    ]
  },
  5: {
    icon: 'üü¶',
    name: 'Libertad',
    desc: '¬°Lograste libertad financiera completa!',
    gradient: 'linear-gradient(135deg, #8b5cf6, #7c3aed)',
    steps: [
      'Protege y preserva tu riqueza',
      'Optimiza estrategias fiscales',
      'Planifica legado generacional',
      'Considera impacto filantr√≥pico'
    ]
  }
};

// Initialize from localStorage
window.addEventListener('DOMContentLoaded', () => {
  loadCardState();
});

function loadCardState() {
  const results = localStorage.getItem('financialRadiografiaResults');
  const inProgress = localStorage.getItem('financialRadiografiaInProgress');
  
  if (results) {
    const data = JSON.parse(results);
    updateCardToCompleted(data);
  } else if (inProgress) {
    updateCardToIncomplete();
  }
}

function openModal() {
  const modal = document.getElementById('modal');
  modal.classList.add('show');
  loadQuestionnaire();
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  const modal = document.getElementById('modal');
  modal.classList.remove('show');
  document.body.style.overflow = '';
}

function loadQuestionnaire() {
  const container = document.getElementById('questionnaireContainer');
  container.innerHTML = `
    <div style="text-align: center; padding: 60px 20px;">
      <h2 style="font-size: 28px; font-weight: 800; margin-bottom: 16px;">Cuestionario de Radiograf√≠a</h2>
      <p style="color: #64748b; margin-bottom: 32px;">Aqu√≠ se integrar√≠a el cuestionario completo</p>
      <p style="color: #64748b; margin-bottom: 32px; font-size: 14px;">En producci√≥n, este ser√≠a un componente con las 14 preguntas del cuestionario que adjuntaste</p>
      <button class="cta-button" onclick="simulateQuestionnaireComplete()">
        Simular Completado
      </button>
    </div>
  `;
}

function simulateQuestionnaireComplete() {
  const sampleResult = {
    stage: 2,
    progress: 65,
    issues: [
      'Tu reserva ideal es 9 meses (tienes 3)',
      'Nivel de deuda todav√≠a alto (>30% del ingreso)',
      'Deber√≠as ahorrar al menos 15% mensual',
      'Seguro de Vida (tienes dependientes)'
    ]
  };
  
  localStorage.setItem('financialRadiografiaResults', JSON.stringify(sampleResult));
  localStorage.removeItem('financialRadiografiaInProgress');
  updateCardToCompleted(sampleResult);
  closeModal();
}

function updateCardToCompleted(data) {
  const card = document.getElementById('mainCard');
  const stage = STAGES[data.stage];
  
  // Calculate overall progress with checklist
  const checkedItems = JSON.parse(localStorage.getItem('financialRadiografiaChecked') || '{}');
  const totalIssues = data.issues.length;
  const checkedCount = Object.values(checkedItems).filter(Boolean).length;
  const issuesProgress = totalIssues > 0 ? Math.round((checkedCount / totalIssues) * 100) : 0;
  const overallProgress = Math.round((data.progress + issuesProgress) / 2);
  
  card.innerHTML = `
    <div class="card-state completed-state active">
      <div class="stage-header" style="background: ${stage.gradient}">
        <span class="stage-icon">${stage.icon}</span>
        <div class="stage-info">
          <h3>Etapa ${data.stage}: ${stage.name}</h3>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${overallProgress}%"></div>
          </div>
          <span class="progress-label">${overallProgress}% de progreso</span>
        </div>
      </div>

      <div class="issues-checklist">
        <h4>√Åreas por mejorar</h4>
        ${data.issues.length > 0 ? `
          <ul id="actualChecklist">
            ${data.issues.map((issue, index) => `
              <li ${checkedItems[index] ? 'class="checked"' : ''}>
                <label>
                  <input type="checkbox" ${checkedItems[index] ? 'checked' : ''} onchange="toggleActualCheck(this, ${index})">
                  <span class="checkbox-custom"></span>
                  <span class="issue-text">${issue}</span>
                </label>
              </li>
            `).join('')}
          </ul>
        ` : `
          <p class="no-issues">¬°Felicidades! Vas muy bien</p>
        `}
      </div>

      <button class="cta-button outlined" onclick="openModal()">
        <span>Actualizar radiograf√≠a</span>
        <span class="arrow">üîÑ</span>
      </button>
    </div>
  `;
}

function toggleActualCheck(checkbox, index) {
  const li = checkbox.closest('li');
  if (checkbox.checked) {
    li.classList.add('checked');
  } else {
    li.classList.remove('checked');
  }
  
  // Save to localStorage
  const checkedItems = JSON.parse(localStorage.getItem('financialRadiografiaChecked') || '{}');
  checkedItems[index] = checkbox.checked;
  localStorage.setItem('financialRadiografiaChecked', JSON.stringify(checkedItems));
  
  // Update progress
  const results = JSON.parse(localStorage.getItem('financialRadiografiaResults'));
  if (results) {
    updateCardToCompleted(results);
  }
}

function toggleDemoCheck(checkbox) {
  const li = checkbox.closest('li');
  if (checkbox.checked) {
    li.classList.add('checked');
  } else {
    li.classList.remove('checked');
  }
}

function updateCardToIncomplete() {
  const card = document.getElementById('mainCard');
  const currentQ = localStorage.getItem('financialRadiografiaCurrentQ') || 7;
  const progress = Math.round((currentQ / 14) * 100);
  
  card.innerHTML = `
    <div class="card-state incomplete-state active">
      <div class="icon-container">
        <span class="large-icon">‚è≥</span>
      </div>
      <h3>Radiograf√≠a Incompleta</h3>
      <p>Est√°s a mitad del camino</p>
      <div class="progress-ring">
        <div class="progress-value">${progress}%</div>
      </div>
      <button class="cta-button secondary" onclick="openModal()">
        <span>Continuar radiograf√≠a</span>
        <span class="arrow">‚Üí</span>
      </button>
    </div>
  `;
}

// Demo controls
function resetCardToInitial() {
  const card = document.getElementById('mainCard');
  card.innerHTML = `
    <div class="card-state initial-state active">
      <div class="icon-container">
        <span class="large-icon">üìä</span>
      </div>
      <h3>Radiograf√≠a Financiera</h3>
      <p>Descubre en qu√© etapa financiera te encuentras</p>
      <button class="cta-button" onclick="openModal()">
        <span>Hacer radiograf√≠a</span>
        <span class="arrow">‚Üí</span>
      </button>
      <p class="small-text">Solo toma 3-4 minutos</p>
    </div>
  `;
}

function simulateIncomplete() {
  localStorage.setItem('financialRadiografiaInProgress', JSON.stringify({ q1: '37' }));
  localStorage.setItem('financialRadiografiaCurrentQ', '7');
  updateCardToIncomplete();
}

function simulateCompleted(stageNum) {
  const sampleResults = {
    1: {
      stage: 1,
      progress: 35,
      issues: [
        'Dependes del cr√©dito para cubrir gastos b√°sicos',
        'No tienes ni un mes de reserva de emergencia',
        'M√°s de la mitad de tu ingreso va a pagar deudas',
        'Seguro de Salud (esencial para todos)'
      ]
    },
    2: {
      stage: 2,
      progress: 65,
      issues: [
        'Tu reserva ideal es 9 meses (tienes 3)',
        'Nivel de deuda todav√≠a alto (>30% del ingreso)',
        'Deber√≠as ahorrar al menos 15% mensual',
        'Seguro de Vida (tienes dependientes)'
      ]
    },
    3: {
      stage: 3,
      progress: 78,
      issues: [
        'Tu patrimonio deber√≠a ser 15√ó tu ingreso anual (tienes 8√ó)',
        'En esta etapa deber√≠as ahorrar 25-30% para acelerar',
        'Empieza a construir fuentes de ingreso pasivo',
        'Testamento/Will (necesario)'
      ]
    },
    4: {
      stage: 4,
      progress: 88,
      issues: [
        'Tus ingresos pasivos a√∫n no cubren todos tus gastos',
        'Aumenta tu patrimonio a 25√ó gastos anuales',
        'Trust o estructuras (para optimizar)'
      ]
    },
    5: {
      stage: 5,
      progress: 100,
      issues: []
    }
  };
  
  const result = sampleResults[stageNum];
  localStorage.setItem('financialRadiografiaResults', JSON.stringify(result));
  localStorage.removeItem('financialRadiografiaChecked');
  updateCardToCompleted(result);
}

function clearAllData() {
  localStorage.removeItem('financialRadiografiaResults');
  localStorage.removeItem('financialRadiografiaInProgress');
  localStorage.removeItem('financialRadiografiaCurrentQ');
  localStorage.removeItem('financialRadiografiaChecked');
  resetCardToInitial();
}

// Close modal on overlay click
document.getElementById('modal').addEventListener('click', closeModal);

// Close modal on ESC key
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    closeModal();
  }
});
</script>
</body>
</html>
