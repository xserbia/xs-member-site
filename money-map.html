<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Xavier Serbia Money Map</title>
<script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;0,9..40,800;1,9..40,400&family=Fraunces:opsz,wght@9..144,600;9..144,700;9..144,800;9..144,900&display=swap" rel="stylesheet">

<style>
:root {
  --primary: #3956E8;
  --emerald: #10b981;
  --emerald-dark: #059669;
  --amber: #f59e0b;
  --charcoal: #18181b;
  --slate: #475569;
  --slate-light: #cbd5e1;
  --bg: #fafafa;
  --card: #ffffff;
  --border: #e2e8f0;
  --text: #0f172a;
  --text-muted: #64748b;
  --danger: #ef4444;
  --warning: #f59e0b;
  --success: #10b981;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
}

.app-container {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Header */
.app-header {
  background: linear-gradient(135deg, var(--primary) 0%, #2845d9 100%);
  color: white;
  padding: 2rem 2rem 0;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.header-content {
  max-width: 1400px;
  margin: 0 auto;
}

.app-subtitle {
  color: var(--slate-light);
  font-size: 1rem;
  margin-bottom: 2rem;
  font-weight: 400;
}

/* Tabs */
.tabs-container {
  display: flex;
  gap: 0.5rem;
  overflow-x: auto;
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.tabs-container::-webkit-scrollbar {
  display: none;
}

.tab-button {
  background: transparent;
  border: none;
  color: rgba(255, 255, 255, 0.6);
  padding: 1rem 1.5rem;
  font-size: 0.95rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  border-bottom: 3px solid transparent;
  white-space: nowrap;
  font-family: 'DM Sans', sans-serif;
}

.tab-button:hover {
  color: rgba(255, 255, 255, 0.9);
  background: rgba(255, 255, 255, 0.05);
}

.tab-button.active {
  color: white;
  border-bottom-color: var(--emerald);
}

/* Main Content */
.main-content {
  flex: 1;
  padding: 2rem;
  max-width: 1400px;
  margin: 0 auto;
  width: 100%;
}

/* Cards */
.card {
  background: var(--card);
  border-radius: 16px;
  padding: 1.5rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  border: 1px solid var(--border);
  margin-bottom: 1.5rem;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 2px solid var(--border);
}

.card-title {
  font-family: 'Fraunces', serif;
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--charcoal);
}

.card-subtitle {
  color: var(--text-muted);
  font-size: 0.875rem;
  margin-top: 0.25rem;
}

/* Form Elements */
.form-group {
  margin-bottom: 1.25rem;
}

.form-label {
  display: block;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--text);
  font-size: 0.9rem;
}

.form-input {
  width: 100%;
  padding: 0.75rem 1rem;
  border: 2px solid var(--border);
  border-radius: 10px;
  font-size: 1rem;
  font-family: 'DM Sans', sans-serif;
  transition: all 0.2s ease;
  background: white;
}

.form-input:focus {
  outline: none;
  border-color: var(--emerald);
  box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
}

.form-input::placeholder {
  color: var(--text-muted);
}

select.form-input {
  cursor: pointer;
}

/* Buttons */
.btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 10px;
  font-weight: 600;
  font-size: 0.95rem;
  cursor: pointer;
  transition: all 0.2s ease;
  font-family: 'DM Sans', sans-serif;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.btn-primary {
  background: var(--primary);
  color: white;
}

.btn-primary:hover {
  background: #2845d9;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(57, 86, 232, 0.3);
}

.btn-danger {
  background: #fecaca;
  color: #991b1b;
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
}

.btn-danger:hover {
  background: #fca5a5;
  color: #7f1d1d;
  transform: translateY(-1px);
}

/* Stats Grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.stat-card {
  background: linear-gradient(135deg, var(--emerald) 0%, var(--emerald-dark) 100%);
  padding: 1.5rem;
  border-radius: 12px;
  color: white;
}

.stat-label {
  font-size: 0.875rem;
  opacity: 0.9;
  margin-bottom: 0.5rem;
}

.stat-value {
  font-family: 'Fraunces', serif;
  font-size: 2rem;
  font-weight: 800;
  line-height: 1;
}

/* Grid Layouts */
.grid-2 {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
}

.grid-3 {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
}

/* Chart Container */
.chart-container {
  position: relative;
  height: 300px;
  margin: 1.5rem 0;
}

/* Export Footer */
.export-footer {
  background: var(--card);
  padding: 1.5rem 2rem;
  border-top: 1px solid var(--border);
  position: sticky;
  bottom: 0;
  z-index: 10;
}

.export-footer-content {
  max-width: 1400px;
  margin: 0 auto;
  display: block;
  text-align: center;
}

.export-info {
  color: var(--text-muted);
  font-size: 0.875rem;
}

/* Utility Classes */
.text-success { color: var(--success); }
.text-warning { color: var(--warning); }
.text-danger { color: var(--danger); }
.text-muted { color: var(--text-muted); }
.text-center { text-align: center; }
.font-bold { font-weight: 700; }
.currency {
  font-family: 'Fraunces', serif;
  font-weight: 700;
  font-feature-settings: 'tnum';
}

/* Responsive */
@media (max-width: 768px) {
  .app-header {
    padding: 1.5rem 1rem 0;
  }
  .main-content {
    padding: 1rem;
  }
  .card {
    padding: 1rem;
  }
  .tab-button {
    padding: 0.75rem 1rem;
    font-size: 0.875rem;
  }
  .stats-grid {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useMemo } = React;

// ============= UTILITY FUNCTIONS =============
const formatCurrency = (value, currencyCode = 'USD') => {
  if (value === null || value === undefined || value === '') {
    const symbols = {
      'USD': '$', 'EUR': 'â‚¬', 'GBP': 'Â£', 'CAD': 'C$',
      'MXN': '$', 'GTQ': 'Q', 'HNL': 'L', 'NIO': 'C$', 'CRC': 'â‚¡', 'PAB': 'B/.',
      'COP': '$', 'VES': 'Bs.', 'BOB': 'Bs.', 'PEN': 'S/', 'BRL': 'R$',
      'PYG': 'â‚²', 'CLP': '$', 'ARS': '$', 'UYU': '$U',
      'DOP': 'RD$', 'CUP': 'â‚±', 'HTG': 'G'
    };
    return `${symbols[currencyCode] || '$'}0`;
  }
  const num = typeof value === 'string' ? parseFloat(value.replace(/,/g, '')) : value;
  if (isNaN(num)) {
    const symbols = {
      'USD': '$', 'EUR': 'â‚¬', 'GBP': 'Â£', 'CAD': 'C$',
      'MXN': '$', 'GTQ': 'Q', 'HNL': 'L', 'NIO': 'C$', 'CRC': 'â‚¡', 'PAB': 'B/.',
      'COP': '$', 'VES': 'Bs.', 'BOB': 'Bs.', 'PEN': 'S/', 'BRL': 'R$',
      'PYG': 'â‚²', 'CLP': '$', 'ARS': '$', 'UYU': '$U',
      'DOP': 'RD$', 'CUP': 'â‚±', 'HTG': 'G'
    };
    return `${symbols[currencyCode] || '$'}0`;
  }
  
  const locales = {
    'USD': 'en-US', 'EUR': 'de-DE', 'GBP': 'en-GB', 'CAD': 'en-CA',
    'MXN': 'es-MX', 'GTQ': 'es-GT', 'HNL': 'es-HN', 'NIO': 'es-NI', 'CRC': 'es-CR', 'PAB': 'es-PA',
    'COP': 'es-CO', 'VES': 'es-VE', 'BOB': 'es-BO', 'PEN': 'es-PE', 'BRL': 'pt-BR',
    'PYG': 'es-PY', 'CLP': 'es-CL', 'ARS': 'es-AR', 'UYU': 'es-UY',
    'DOP': 'es-DO', 'CUP': 'es-CU', 'HTG': 'fr-HT'
  };
  
  return new Intl.NumberFormat(locales[currencyCode] || 'en-US', {
    style: 'currency',
    currency: currencyCode,
    maximumFractionDigits: 0
  }).format(num);
};

const parseNumber = (value) => {
  if (value === null || value === undefined || value === '') return 0;
  const num = typeof value === 'string' ? parseFloat(value.replace(/,/g, '')) : value;
  return isNaN(num) ? 0 : num;
};

// ============= ONBOARDING MODAL COMPONENT =============
function OnboardingModal({ isOpen, onClose, onSave, initialProfile }) {
  const [formData, setFormData] = useState({
    ...initialProfile,
    parejaNombre: initialProfile.parejaNombre || '',
    parejaApellido: initialProfile.parejaApellido || '',
    parejaAvatar: initialProfile.parejaAvatar || 'ğŸ‘¤'
  });
  
  const avatarOptions = ['ğŸ‘¤', 'ğŸ‘¨', 'ğŸ‘©', 'ğŸ§‘', 'ğŸ‘¨â€ğŸ’¼', 'ğŸ‘©â€ğŸ’¼', 'ğŸ‘¨â€ğŸ“', 'ğŸ‘©â€ğŸ“', 'ğŸ§”', 'ğŸ‘¨â€ğŸ¦°', 'ğŸ‘©â€ğŸ¦°', 'ğŸ‘±â€â™‚ï¸', 'ğŸ‘±â€â™€ï¸'];
  
  const handleSubmit = (e) => {
    e.preventDefault();
    const isCouple = formData.estadoCivil === 'casado' || formData.estadoCivil === 'pareja';
    const profileToSave = {
      ...formData,
      // Clear partner fields if not a couple
      parejaNombre: isCouple ? formData.parejaNombre : '',
      parejaApellido: isCouple ? formData.parejaApellido : '',
      parejaAvatar: isCouple ? formData.parejaAvatar : 'ğŸ‘¤'
    };
    onSave(profileToSave);
    onClose();
  };
  
  const updateField = (field, value) => {
    setFormData(prev => ({ ...prev, [field]: value }));
  };
  
  if (!isOpen) return null;
  
  return (
    <div style={{
      position: 'absolute',
      top: 0,
      left: 0,
      right: 0,
      bottom: 0,
      background: 'rgba(0,0,0,0.7)',
      zIndex: 2000,
      display: 'flex',
      alignItems: 'flex-start',
      justifyContent: 'center',
      padding: '20px',
      paddingTop: '40px',
      backdropFilter: 'blur(8px)',
      overflowY: 'auto'
    }} onClick={onClose}>
      <div style={{
        background: '#fff',
        borderRadius: '20px',
        maxWidth: '500px',
        width: '100%',
        maxHeight: '90vh',
        overflow: 'auto',
        boxShadow: '0 25px 70px rgba(0,0,0,0.5)'
      }} onClick={(e) => e.stopPropagation()}>
        
        {/* Header */}
        <div style={{padding: '2rem 2rem 1rem', borderBottom: '1px solid var(--border)', textAlign: 'center', position: 'relative'}}>
          <button 
            onClick={onClose}
            style={{
              position: 'absolute',
              top: '1rem',
              right: '1rem',
              background: 'rgba(0,0,0,0.05)',
              border: 'none',
              width: '32px',
              height: '32px',
              borderRadius: '50%',
              fontSize: '20px',
              cursor: 'pointer',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              transition: 'all 0.2s',
              color: '#666'
            }}
          >
            Ã—
          </button>
          <div style={{fontSize: '3rem', marginBottom: '1rem'}}>ğŸ‘‹</div>
          <img 
            src="https://xserbia.github.io/calculadora-financiera/assets/XAVIER-MONEY-MAP-LOGO-2.png" 
            alt="Xavier Serbia Money Map"
            style={{height: '70px', marginBottom: '0.75rem'}}
          />
          <div style={{color: 'var(--text-muted)', fontSize: '0.95rem'}}>Tu perfil financiero</div>
        </div>

        {/* Form */}
        <form onSubmit={handleSubmit} style={{padding: '2rem'}}>
          
          {/* Avatar Selection */}
          <div style={{marginBottom: '1.5rem', textAlign: 'center'}}>
            <label style={{display: 'block', fontWeight: '600', marginBottom: '1rem', color: '#333'}}>
              Elige tu avatar
            </label>
            <div style={{display: 'flex', gap: '0.75rem', justifyContent: 'center', flexWrap: 'wrap'}}>
              {avatarOptions.map(avatar => (
                <button
                  key={avatar}
                  type="button"
                  onClick={() => updateField('avatar', avatar)}
                  style={{
                    fontSize: '2rem',
                    width: '60px',
                    height: '60px',
                    border: formData.avatar === avatar ? '3px solid var(--primary)' : '2px solid var(--border)',
                    borderRadius: '50%',
                    background: formData.avatar === avatar ? 'rgba(59, 130, 246, 0.1)' : 'white',
                    cursor: 'pointer',
                    transition: 'all 0.2s',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center'
                  }}
                >
                  {avatar}
                </button>
              ))}
            </div>
          </div>

          {/* Name Fields */}
          <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem', marginBottom: '1.5rem'}}>
            <div>
              <label style={{display: 'block', fontWeight: '600', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
                Nombre *
              </label>
              <input
                type="text"
                required
                value={formData.nombre}
                onChange={(e) => updateField('nombre', e.target.value)}
                placeholder="Juan"
                className="form-input"
              />
            </div>
            <div>
              <label style={{display: 'block', fontWeight: '600', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
                Apellido *
              </label>
              <input
                type="text"
                required
                value={formData.apellido}
                onChange={(e) => updateField('apellido', e.target.value)}
                placeholder="PÃ©rez"
                className="form-input"
              />
            </div>
          </div>

          {/* Edad */}
          <div style={{marginBottom: '1.5rem'}}>
            <label style={{display: 'block', fontWeight: '600', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
              Edad *
            </label>
            <input
              type="number"
              required
              min="18"
              max="100"
              value={formData.edad}
              onChange={(e) => updateField('edad', e.target.value)}
              placeholder="30"
              className="form-input"
            />
          </div>

          {/* Estado Civil */}
          <div style={{marginBottom: '1.5rem'}}>
            <label style={{display: 'block', fontWeight: '600', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
              Estado Civil *
            </label>
            <select
              required
              value={formData.estadoCivil}
              onChange={(e) => updateField('estadoCivil', e.target.value)}
              className="form-input"
            >
              <option value="soltero">Soltero/a</option>
              <option value="casado">Casado/a</option>
              <option value="pareja">En pareja / UniÃ³n libre</option>
              <option value="divorciado">Divorciado/a</option>
              <option value="viudo">Viudo/a</option>
            </select>
          </div>

          {/* Campos de pareja - solo si estÃ¡ casado o en pareja */}
          {(formData.estadoCivil === 'casado' || formData.estadoCivil === 'pareja') && (
            <>
              <div style={{
                background: '#eff6ff',
                border: '2px solid var(--primary)',
                borderRadius: '12px',
                padding: '1rem',
                marginBottom: '1.5rem'
              }}>
                <div style={{display: 'flex', gap: '0.75rem', alignItems: 'flex-start'}}>
                  <span style={{fontSize: '1.5rem'}}>ğŸ’¡</span>
                  <div>
                    <div style={{fontWeight: '700', marginBottom: '0.25rem', color: 'var(--primary)'}}>
                      AnÃ¡lisis Financiero Conjunto
                    </div>
                    <div style={{fontSize: '0.875rem', color: '#1e40af', lineHeight: '1.5'}}>
                      El dashboard analizarÃ¡ las finanzas de ambos como una unidad familiar. 
                      Ingresa los ingresos, gastos y activos combinados.
                    </div>
                  </div>
                </div>
              </div>

              {/* Partner Avatar Selection */}
              <div style={{marginBottom: '1.5rem', textAlign: 'center', background: '#f8fafc', padding: '1.5rem', borderRadius: '12px'}}>
                <label style={{display: 'block', fontWeight: '600', marginBottom: '1rem', color: '#333'}}>
                  Elige el avatar de tu pareja
                </label>
                <div style={{display: 'flex', gap: '0.75rem', justifyContent: 'center', flexWrap: 'wrap'}}>
                  {avatarOptions.map(avatar => (
                    <button
                      key={`partner-${avatar}`}
                      type="button"
                      onClick={() => updateField('parejaAvatar', avatar)}
                      style={{
                        fontSize: '2rem',
                        width: '60px',
                        height: '60px',
                        border: formData.parejaAvatar === avatar ? '3px solid var(--primary)' : '2px solid var(--border)',
                        borderRadius: '50%',
                        background: formData.parejaAvatar === avatar ? 'rgba(59, 130, 246, 0.1)' : 'white',
                        cursor: 'pointer',
                        transition: 'all 0.2s',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center'
                      }}
                    >
                      {avatar}
                    </button>
                  ))}
                </div>
              </div>

              {/* Partner Name Fields */}
              <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem', marginBottom: '1.5rem'}}>
                <div>
                  <label style={{display: 'block', fontWeight: '600', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
                    Nombre de tu pareja *
                  </label>
                  <input
                    type="text"
                    required
                    value={formData.parejaNombre}
                    onChange={(e) => updateField('parejaNombre', e.target.value)}
                    placeholder="MarÃ­a"
                    className="form-input"
                  />
                </div>
                <div>
                  <label style={{display: 'block', fontWeight: '600', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
                    Apellido de tu pareja *
                  </label>
                  <input
                    type="text"
                    required
                    value={formData.parejaApellido}
                    onChange={(e) => updateField('parejaApellido', e.target.value)}
                    placeholder="GonzÃ¡lez"
                    className="form-input"
                  />
                </div>
              </div>
            </>
          )}

          {/* Dependientes */}
          <div style={{marginBottom: '2rem'}}>
            <label style={{display: 'block', fontWeight: '600', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
              NÃºmero de Dependientes
            </label>
            <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
              <input
                type="number"
                min="0"
                max="20"
                value={formData.dependientes}
                onChange={(e) => updateField('dependientes', parseInt(e.target.value) || 0)}
                className="form-input"
              />
              <span style={{fontSize: '1.5rem', minWidth: '80px'}}>
                {formData.dependientes > 0 ? 'ğŸ‘¶'.repeat(Math.min(formData.dependientes, 5)) : 'â€”'}
                {formData.dependientes > 5 && ` +${formData.dependientes - 5}`}
              </span>
            </div>
            <div style={{fontSize: '0.8rem', color: 'var(--text-muted)', marginTop: '0.5rem'}}>
              Hijos, padres u otras personas que dependan econÃ³micamente de ti
            </div>
          </div>

          {/* Buttons */}
          <button
            type="submit"
            className="btn btn-primary"
            style={{width: '100%', justifyContent: 'center'}}
          >
            Guardar Perfil ğŸš€
          </button>
        </form>
      </div>
    </div>
  );
}

// ============= MAIN APP COMPONENT =============
function App() {
  const [activeTab, setActiveTab] = useState('datos');
  const [currency, setCurrency] = useState('USD');
  const [showOnboardingModal, setShowOnboardingModal] = useState(false);
  const [showHelpModal, setShowHelpModal] = useState(false);
  const [showPDFModal, setShowPDFModal] = useState(false);
  
  // User profile
  const [userProfile, setUserProfile] = useState({
    nombre: '',
    apellido: '',
    edad: '',
    estadoCivil: 'soltero',
    dependientes: 0,
    avatar: 'ğŸ‘¤',
    parejaNombre: '',
    parejaApellido: '',
    parejaAvatar: 'ğŸ‘¤'
  });

  // Show profile modal on first load
  useEffect(() => {
    if (!userProfile.nombre || !userProfile.apellido) {
      setShowOnboardingModal(true);
    }
  }, []);

  // Scroll to top when modals open (para embeds en Wix/iframes)
  useEffect(() => {
    if (showOnboardingModal || showHelpModal || showPDFModal) {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      // TambiÃ©n intentar scroll del contenedor
      const container = document.querySelector('.app-container');
      if (container) {
        container.scrollTop = 0;
      }
    }
  }, [showOnboardingModal, showHelpModal, showPDFModal]);

  // Financial data - NO localStorage
  const [modoCalculo, setModoCalculo] = useState('mensual');
  
  // Flujo de Caja
  const [ingresoBruto, setIngresoBruto] = useState('');
  const [ahorro, setAhorro] = useState('');
  const [deudas, setDeudas] = useState('');
  const [gastosDiarios, setGastosDiarios] = useState('');
  const [seguros, setSeguros] = useState('');
  const [impuestos, setImpuestos] = useState('');
  
  // Activos
  const [efectivo, setEfectivo] = useState('');
  const [inversiones, setInversiones] = useState('');
  const [retiro, setRetiro] = useState('');
  const [bienesRaices, setBienesRaices] = useState('');
  const [bienesPersonales, setBienesPersonales] = useState('');
  
  // Pasivos
  const [tarjetas, setTarjetas] = useState('');
  const [lineaPersonal, setLineaPersonal] = useState('');
  const [lineaPropiedad, setLineaPropiedad] = useState('');
  const [hipoteca, setHipoteca] = useState('');
  const [prestamoAuto, setPrestamoAuto] = useState('');
  const [prestamosEducativos, setPrestamosEducativos] = useState('');
  const [otrosPrestamos, setOtrosPrestamos] = useState('');
  
  // Datos adicionales
  const [gastosEsenciales, setGastosEsenciales] = useState('');
  const [reservaEmergencia, setReservaEmergencia] = useState('');
  const [pagoMensualDeudas, setPagoMensualDeudas] = useState('');

  // Clear all data
  const clearAllData = () => {
    if (confirm('âš ï¸ Â¿EstÃ¡s seguro de que quieres borrar TODOS los datos?\n\nEsta acciÃ³n no se puede deshacer.')) {
      setIngresoBruto('');
      setAhorro('');
      setDeudas('');
      setGastosDiarios('');
      setSeguros('');
      setImpuestos('');
      setEfectivo('');
      setInversiones('');
      setRetiro('');
      setBienesRaices('');
      setBienesPersonales('');
      setTarjetas('');
      setLineaPersonal('');
      setLineaPropiedad('');
      setHipoteca('');
      setPrestamoAuto('');
      setPrestamosEducativos('');
      setOtrosPrestamos('');
      setGastosEsenciales('');
      setReservaEmergencia('');
      setPagoMensualDeudas('');
    }
  };

  // ===== COMPUTED VALUES =====
  const totales = useMemo(() => {
    const mult = modoCalculo === 'anual' ? 1 : 12;
    
    // Activos
    const totalEfectivo = parseNumber(efectivo);
    const totalInversiones = parseNumber(inversiones);
    const totalRetiro = parseNumber(retiro);
    const totalBienesRaices = parseNumber(bienesRaices);
    const totalBienesPersonales = parseNumber(bienesPersonales);
    const activosTotales = totalEfectivo + totalInversiones + totalRetiro + totalBienesRaices + totalBienesPersonales;
    
    // Pasivos
    const totalTarjetas = parseNumber(tarjetas);
    const totalLineaPersonal = parseNumber(lineaPersonal);
    const totalLineaPropiedad = parseNumber(lineaPropiedad);
    const totalHipoteca = parseNumber(hipoteca);
    const totalPrestamoAuto = parseNumber(prestamoAuto);
    const totalPrestamosEducativos = parseNumber(prestamosEducativos);
    const totalOtrosPrestamos = parseNumber(otrosPrestamos);
    const pasivosTotales = totalTarjetas + totalLineaPersonal + totalLineaPropiedad + totalHipoteca + totalPrestamoAuto + totalPrestamosEducativos + totalOtrosPrestamos;
    
    // Patrimonio
    const patrimonioNeto = activosTotales - pasivosTotales;
    
    // Flujo de caja
    const totalIngresos = parseNumber(ingresoBruto) * mult;
    const totalAhorro = parseNumber(ahorro) * mult;
    const totalDeudas = parseNumber(deudas) * mult;
    const totalGastosDiarios = parseNumber(gastosDiarios) * mult;
    const totalSeguros = parseNumber(seguros) * mult;
    const totalImpuestos = parseNumber(impuestos) * mult;
    const totalGastos = totalDeudas + totalGastosDiarios + totalSeguros + totalImpuestos;
    const superavit = totalIngresos - totalGastos - totalAhorro;

    return {
      activosTotales,
      pasivosTotales,
      patrimonioNeto,
      totalIngresos,
      totalGastos,
      totalAhorro,
      superavit,
      totalEfectivo,
      totalInversiones,
      totalRetiro,
      totalBienesRaices,
      totalBienesPersonales,
      activosLiquidos: totalEfectivo,
      inversiones: totalInversiones + totalRetiro
    };
  }, [ingresoBruto, ahorro, deudas, gastosDiarios, seguros, impuestos, efectivo, inversiones, retiro, bienesRaices, bienesPersonales, tarjetas, lineaPersonal, lineaPropiedad, hipoteca, prestamoAuto, prestamosEducativos, otrosPrestamos, modoCalculo]);

  return (
    <div className="app-container" style={{position: 'relative', minHeight: '100vh'}}>
      {/* Onboarding Modal */}
      <OnboardingModal
        isOpen={showOnboardingModal}
        onClose={() => setShowOnboardingModal(false)}
        onSave={setUserProfile}
        initialProfile={userProfile}
      />
      
      <header className="app-header">
        <div className="header-content">
          <img 
            src="https://xserbia.github.io/calculadora-financiera/assets/XAVIER-MONEY-MAP-LOGO.png" 
            alt="Xavier Serbia Money Map"
            style={{height: '60px', marginBottom: '0.5rem'}}
          />
          <p className="app-subtitle">Tu mapa financiero personal hacia la libertad econÃ³mica</p>
          
          <div style={{display: 'flex', gap: '1rem', alignItems: 'center', marginBottom: '1.5rem', flexWrap: 'wrap'}}>
            <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
              <label style={{color: 'rgba(255,255,255,0.8)', fontSize: '0.9rem', fontWeight: '600'}}>Moneda:</label>
              <select 
                value={currency}
                onChange={(e) => setCurrency(e.target.value)}
                style={{
                  padding: '0.5rem 1rem',
                  borderRadius: '8px',
                  border: '2px solid rgba(255,255,255,0.2)',
                  background: 'rgba(255,255,255,0.1)',
                  color: 'white',
                  fontWeight: '600',
                  fontSize: '0.9rem',
                  cursor: 'pointer',
                  outline: 'none'
                }}
              >
                <option value="USD" style={{background: '#2845d9', color: 'white'}}>ğŸ‡ºğŸ‡¸ USD - DÃ³lar</option>
                <option value="EUR" style={{background: '#2845d9', color: 'white'}}>ğŸ‡ªğŸ‡º EUR - Euro</option>
                <option value="GBP" style={{background: '#2845d9', color: 'white'}}>ğŸ‡¬ğŸ‡§ GBP - Libra</option>
                <option value="CAD" style={{background: '#2845d9', color: 'white'}}>ğŸ‡¨ğŸ‡¦ CAD - DÃ³lar Canadiense</option>
                <option value="MXN" style={{background: '#2845d9', color: 'white'}}>ğŸ‡²ğŸ‡½ MXN - Peso Mexicano</option>
                <option value="GTQ" style={{background: '#2845d9', color: 'white'}}>ğŸ‡¬ğŸ‡¹ GTQ - Quetzal Guatemalteco</option>
                <option value="HNL" style={{background: '#2845d9', color: 'white'}}>ğŸ‡­ğŸ‡³ HNL - Lempira HondureÃ±o</option>
                <option value="NIO" style={{background: '#2845d9', color: 'white'}}>ğŸ‡³ğŸ‡® NIO - CÃ³rdoba NicaragÃ¼ense</option>
                <option value="CRC" style={{background: '#2845d9', color: 'white'}}>ğŸ‡¨ğŸ‡· CRC - ColÃ³n Costarricense</option>
                <option value="PAB" style={{background: '#2845d9', color: 'white'}}>ğŸ‡µğŸ‡¦ PAB - Balboa PanameÃ±o</option>
                <option value="COP" style={{background: '#2845d9', color: 'white'}}>ğŸ‡¨ğŸ‡´ COP - Peso Colombiano</option>
                <option value="VES" style={{background: '#2845d9', color: 'white'}}>ğŸ‡»ğŸ‡ª VES - BolÃ­var Venezolano</option>
                <option value="BOB" style={{background: '#2845d9', color: 'white'}}>ğŸ‡§ğŸ‡´ BOB - Boliviano</option>
                <option value="PEN" style={{background: '#2845d9', color: 'white'}}>ğŸ‡µğŸ‡ª PEN - Sol Peruano</option>
                <option value="BRL" style={{background: '#2845d9', color: 'white'}}>ğŸ‡§ğŸ‡· BRL - Real BrasileÃ±o</option>
                <option value="PYG" style={{background: '#2845d9', color: 'white'}}>ğŸ‡µğŸ‡¾ PYG - GuaranÃ­ Paraguayo</option>
                <option value="CLP" style={{background: '#2845d9', color: 'white'}}>ğŸ‡¨ğŸ‡± CLP - Peso Chileno</option>
                <option value="ARS" style={{background: '#2845d9', color: 'white'}}>ğŸ‡¦ğŸ‡· ARS - Peso Argentino</option>
                <option value="UYU" style={{background: '#2845d9', color: 'white'}}>ğŸ‡ºğŸ‡¾ UYU - Peso Uruguayo</option>
                <option value="DOP" style={{background: '#2845d9', color: 'white'}}>ğŸ‡©ğŸ‡´ DOP - Peso Dominicano</option>
                <option value="CUP" style={{background: '#2845d9', color: 'white'}}>ğŸ‡¨ğŸ‡º CUP - Peso Cubano</option>
                <option value="HTG" style={{background: '#2845d9', color: 'white'}}>ğŸ‡­ğŸ‡¹ HTG - Gourde Haitiano</option>
              </select>
            </div>
            
            <button
              onClick={() => setShowOnboardingModal(true)}
              style={{
                padding: '0.5rem 1.25rem',
                borderRadius: '8px',
                border: '2px solid rgba(255,255,255,0.3)',
                background: 'rgba(255,255,255,0.15)',
                color: 'white',
                fontWeight: '600',
                fontSize: '0.9rem',
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                gap: '0.5rem'
              }}
            >
              {(userProfile.estadoCivil === 'casado' || userProfile.estadoCivil === 'pareja') && userProfile.parejaNombre 
                ? `${userProfile.avatar}â¤ï¸${userProfile.parejaAvatar}` 
                : userProfile.avatar
              } Mi Perfil
            </button>
            
            <button
              onClick={() => setShowHelpModal(true)}
              style={{
                padding: '0.5rem 1.25rem',
                borderRadius: '8px',
                border: '2px solid rgba(255,255,255,0.3)',
                background: 'rgba(255,255,255,0.15)',
                color: 'white',
                fontWeight: '600',
                fontSize: '0.9rem',
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                gap: '0.5rem'
              }}
            >
              â“ CÃ³mo usar
            </button>
            
            <button
              onClick={() => setShowPDFModal(true)}
              style={{
                padding: '0.5rem 1.25rem',
                borderRadius: '8px',
                border: '2px solid rgba(16, 185, 129, 0.5)',
                background: 'rgba(16, 185, 129, 0.2)',
                color: 'white',
                fontWeight: '600',
                fontSize: '0.9rem',
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                gap: '0.5rem'
              }}
            >
              ğŸ“„ PDF Worksheets
            </button>
            
            <button
              onClick={clearAllData}
              className="btn btn-danger"
              style={{
                border: '2px solid rgba(239, 68, 68, 0.5)',
                background: 'rgba(239, 68, 68, 0.15)',
                color: 'white'
              }}
            >
              ğŸ—‘ï¸ Limpiar Datos
            </button>
          </div>

          {/* Nota sobre datos */}
          <div style={{
            background: 'rgba(255, 193, 7, 0.2)',
            border: '2px solid rgba(255, 193, 7, 0.5)',
            borderRadius: '12px',
            padding: '1rem 1.25rem',
            marginBottom: '1.5rem',
            display: 'flex',
            alignItems: 'center',
            gap: '0.75rem'
          }}>
            <span style={{fontSize: '1.5rem'}}>âš ï¸</span>
            <div style={{flex: 1}}>
              <div style={{fontWeight: '700', fontSize: '0.95rem', marginBottom: '0.25rem'}}>
                Tus datos NO se guardan automÃ¡ticamente
              </div>
              <div style={{fontSize: '0.85rem', opacity: 0.9, lineHeight: '1.4'}}>
                Los datos se borran al cerrar o recargar la pÃ¡gina. Usa el PDF Worksheet para guardar tu informaciÃ³n de forma permanente y solo ingresa los totales en esta calculadora para anÃ¡lisis rÃ¡pido.
              </div>
            </div>
          </div>
          
          <div className="tabs-container">
            <button 
              className={`tab-button ${activeTab === 'datos' ? 'active' : ''}`}
              onClick={() => setActiveTab('datos')}
            >
              âœï¸ Ingresar Datos
            </button>
            <button 
              className={`tab-button ${activeTab === 'vistaGeneral' ? 'active' : ''}`}
              onClick={() => setActiveTab('vistaGeneral')}
            >
              ğŸ“Š Vista General
            </button>
            <button 
              className={`tab-button ${activeTab === 'graficos' ? 'active' : ''}`}
              onClick={() => setActiveTab('graficos')}
            >
              ğŸ“ˆ GrÃ¡ficos
            </button>
            <button 
              className={`tab-button ${activeTab === 'ratios' ? 'active' : ''}`}
              onClick={() => setActiveTab('ratios')}
            >
              ğŸ“Š Ratios Financieros
            </button>
          </div>
        </div>
      </header>

      <main className="main-content">
        {activeTab === 'datos' && (
          <DatosTab
            modoCalculo={modoCalculo}
            setModoCalculo={setModoCalculo}
            ingresoBruto={ingresoBruto}
            setIngresoBruto={setIngresoBruto}
            ahorro={ahorro}
            setAhorro={setAhorro}
            deudas={deudas}
            setDeudas={setDeudas}
            gastosDiarios={gastosDiarios}
            setGastosDiarios={setGastosDiarios}
            seguros={seguros}
            setSeguros={setSeguros}
            impuestos={impuestos}
            setImpuestos={setImpuestos}
            efectivo={efectivo}
            setEfectivo={setEfectivo}
            inversiones={inversiones}
            setInversiones={setInversiones}
            retiro={retiro}
            setRetiro={setRetiro}
            bienesRaices={bienesRaices}
            setBienesRaices={setBienesRaices}
            bienesPersonales={bienesPersonales}
            setBienesPersonales={setBienesPersonales}
            tarjetas={tarjetas}
            setTarjetas={setTarjetas}
            lineaPersonal={lineaPersonal}
            setLineaPersonal={setLineaPersonal}
            lineaPropiedad={lineaPropiedad}
            setLineaPropiedad={setLineaPropiedad}
            hipoteca={hipoteca}
            setHipoteca={setHipoteca}
            prestamoAuto={prestamoAuto}
            setPrestamoAuto={setPrestamoAuto}
            prestamosEducativos={prestamosEducativos}
            setPrestamosEducativos={setPrestamosEducativos}
            otrosPrestamos={otrosPrestamos}
            setOtrosPrestamos={setOtrosPrestamos}
            gastosEsenciales={gastosEsenciales}
            setGastosEsenciales={setGastosEsenciales}
            reservaEmergencia={reservaEmergencia}
            setReservaEmergencia={setReservaEmergencia}
            pagoMensualDeudas={pagoMensualDeudas}
            setPagoMensualDeudas={setPagoMensualDeudas}
            currency={currency}
          />
        )}
        {activeTab === 'vistaGeneral' && (
          <VistaGeneral 
            totales={totales}
            userProfile={userProfile}
            currency={currency}
            setActiveTab={setActiveTab}
          />
        )}
        {activeTab === 'graficos' && (
          <GraficosTab 
            totales={totales}
            currency={currency}
            ingresoBruto={parseNumber(ingresoBruto)}
            ahorro={parseNumber(ahorro)}
            deudas={parseNumber(deudas)}
            gastosDiarios={parseNumber(gastosDiarios)}
            seguros={parseNumber(seguros)}
            impuestos={parseNumber(impuestos)}
            modoCalculo={modoCalculo}
            tarjetas={parseNumber(tarjetas)}
            lineaPersonal={parseNumber(lineaPersonal)}
            lineaPropiedad={parseNumber(lineaPropiedad)}
            hipoteca={parseNumber(hipoteca)}
            prestamoAuto={parseNumber(prestamoAuto)}
            prestamosEducativos={parseNumber(prestamosEducativos)}
            otrosPrestamos={parseNumber(otrosPrestamos)}
          />
        )}
        {activeTab === 'ratios' && (
          <RatiosFinancieros 
            totales={totales}
            userProfile={userProfile}
            currency={currency}
            ingresoBruto={parseNumber(ingresoBruto)}
            ahorro={parseNumber(ahorro)}
            deudas={parseNumber(deudas)}
            seguros={parseNumber(seguros)}
            impuestos={parseNumber(impuestos)}
            gastosEsenciales={parseNumber(gastosEsenciales)}
            reservaEmergencia={parseNumber(reservaEmergencia)}
            pagoMensualDeudas={parseNumber(pagoMensualDeudas)}
            modoCalculo={modoCalculo}
          />
        )}
      </main>

      {/* Help Modal */}
      {showHelpModal && (
        <div style={{
          position: 'absolute',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0,0,0,0.7)',
          zIndex: 2000,
          display: 'flex',
          alignItems: 'flex-start',
          justifyContent: 'center',
          padding: '20px',
          paddingTop: '40px',
          backdropFilter: 'blur(8px)',
          overflowY: 'auto'
        }} onClick={() => setShowHelpModal(false)}>
          <div style={{
            background: '#fff',
            borderRadius: '20px',
            maxWidth: '800px',
            width: '100%',
            maxHeight: '90vh',
            overflow: 'hidden',
            display: 'flex',
            flexDirection: 'column',
            boxShadow: '0 25px 70px rgba(0,0,0,0.5)'
          }} onClick={(e) => e.stopPropagation()}>
            <div style={{padding: '24px 28px', background: 'var(--primary)', borderBottom: '1px solid var(--border)', display: 'flex', alignItems: 'center', justifyContent: 'space-between'}}>
              <div style={{fontSize: '24px', fontWeight: '800', color: 'white'}}>ğŸ—ºï¸ CÃ³mo usar Money Map</div>
              <button onClick={() => setShowHelpModal(false)} style={{background: 'rgba(255,255,255,0.2)', border: 'none', width: '36px', height: '36px', borderRadius: '50%', fontSize: '22px', cursor: 'pointer', color: 'white'}}>Ã—</button>
            </div>
            <div style={{padding: '32px', overflowY: 'auto', lineHeight: '1.7'}}>
              <h3 style={{margin: '0 0 16px', fontSize: '20px', fontWeight: '700', color: 'var(--primary)'}}>
                ğŸ¯ Â¿Para quÃ© sirve esta calculadora?
              </h3>
              <p style={{marginBottom: '24px', fontSize: '15px', color: 'var(--text)'}}>
                Esta calculadora te ayuda a <strong>obtener una foto completa de tu salud financiera</strong> calculando ratios clave que te indican si estÃ¡s en buen camino hacia tus metas financieras. PodrÃ¡s ver:
              </p>
              <ul style={{marginBottom: '32px', paddingLeft: '24px', fontSize: '15px', color: 'var(--text)'}}>
                <li style={{marginBottom: '12px'}}><strong>Tu patrimonio neto</strong> (lo que realmente tienes vs. lo que debes)</li>
                <li style={{marginBottom: '12px'}}><strong>Tu capacidad de ahorro</strong> (cuÃ¡nto guardas del dinero que ganas)</li>
                <li style={{marginBottom: '12px'}}><strong>Tu nivel de deuda</strong> (si tus deudas estÃ¡n bajo control)</li>
                <li style={{marginBottom: '12px'}}><strong>Tu nivel de riqueza</strong> (si estÃ¡s acumulando patrimonio segÃºn tu edad)</li>
                <li style={{marginBottom: '12px'}}><strong>Tu preparaciÃ³n financiera</strong> (si tienes reserva de emergencia adecuada)</li>
              </ul>

              <h3 style={{margin: '32px 0 16px', fontSize: '20px', fontWeight: '700', color: 'var(--primary)'}}>
                ğŸ“ Â¿CÃ³mo funciona?
              </h3>
              
              <div style={{background: '#f0f9ff', padding: '20px', borderRadius: '12px', marginBottom: '20px', borderLeft: '4px solid var(--primary)'}}>
                <h4 style={{margin: '0 0 12px', fontSize: '16px', fontWeight: '700', color: 'var(--text)'}}>Paso 1: Usa el PDF Worksheet</h4>
                <p style={{margin: 0, fontSize: '14px', color: 'var(--text-muted)'}}>
                  Descarga el PDF Worksheet y llena todos los detalles de tus ingresos, gastos, activos y pasivos. El worksheet tiene categorÃ­as detalladas para que no se te escape nada. Calcula los <strong>TOTALES</strong> de cada categorÃ­a.
                </p>
              </div>

              <div style={{background: '#fef3f2', padding: '20px', borderRadius: '12px', marginBottom: '20px', borderLeft: '4px solid var(--danger)'}}>
                <h4 style={{margin: '0 0 12px', fontSize: '16px', fontWeight: '700', color: 'var(--text)'}}>Paso 2: Ingresa solo los TOTALES</h4>
                <p style={{margin: 0, fontSize: '14px', color: 'var(--text-muted)'}}>
                  En la pestaÃ±a <strong>"Ingresar Datos"</strong> de esta calculadora, copia Ãºnicamente los totales que calculaste en el worksheet. No necesitas ingresar cada detalle, solo las sumas finales de cada categorÃ­a.
                </p>
              </div>

              <div style={{background: '#f0fdf4', padding: '20px', borderRadius: '12px', marginBottom: '20px', borderLeft: '4px solid var(--success)'}}>
                <h4 style={{margin: '0 0 12px', fontSize: '16px', fontWeight: '700', color: 'var(--text)'}}>Paso 3: Revisa tus resultados</h4>
                <p style={{margin: 0, fontSize: '14px', color: 'var(--text-muted)'}}>
                  Ve a las pestaÃ±as de <strong>"Vista General"</strong>, <strong>"GrÃ¡ficos"</strong> y <strong>"Ratios Financieros"</strong> para ver anÃ¡lisis visuales y comparar tus nÃºmeros con benchmarks financieros reconocidos.
                </p>
              </div>

              <div style={{background: '#fffbeb', padding: '20px', borderRadius: '12px', marginBottom: '24px', borderLeft: '4px solid var(--amber)'}}>
                <h4 style={{margin: '0 0 12px', fontSize: '16px', fontWeight: '700', color: 'var(--text)'}}>Paso 4: Toma decisiones informadas</h4>
                <p style={{margin: 0, fontSize: '14px', color: 'var(--text-muted)'}}>
                  Usa los insights de los ratios para identificar Ã¡reas de mejora. Â¿Tu tasa de ahorro estÃ¡ baja? Â¿Tus deudas estÃ¡n muy altas? Â¿Tu reserva de emergencia es suficiente? Esta herramienta te da las respuestas.
                </p>
              </div>

              <h3 style={{margin: '32px 0 16px', fontSize: '20px', fontWeight: '700', color: 'var(--primary)'}}>
                ğŸ”’ Privacidad y Seguridad
              </h3>
              <div style={{background: '#fff7ed', padding: '20px', borderRadius: '12px', borderLeft: '4px solid #ea580c'}}>
                <p style={{margin: 0, fontSize: '14px', lineHeight: '1.6', color: 'var(--text)'}}>
                  <strong>âš ï¸ IMPORTANTE:</strong> Esta calculadora <strong>NO guarda tus datos automÃ¡ticamente</strong>. Todos los nÃºmeros que ingreses se borrarÃ¡n al cerrar o recargar la pÃ¡gina. Por eso recomendamos usar el PDF Worksheet como tu registro permanente. Solo usa esta calculadora web para anÃ¡lisis rÃ¡pido y visualizaciÃ³n de resultados.
                </p>
              </div>

              <h3 style={{margin: '32px 0 16px', fontSize: '20px', fontWeight: '700', color: 'var(--primary)'}}>
                ğŸ’¡ Consejo Pro
              </h3>
              <div style={{background: '#f8fafc', padding: '20px', borderRadius: '12px', borderLeft: '4px solid var(--slate)'}}>
                <p style={{margin: 0, fontSize: '14px', lineHeight: '1.6', color: 'var(--text)'}}>
                  <strong>SÃ© honesto y completo.</strong> Los datos mÃ¡s precisos te darÃ¡n el anÃ¡lisis mÃ¡s Ãºtil. Esta herramienta es educativa y no constituye asesoramiento financiero profesional. Para decisiones importantes, consulta con un asesor financiero certificado.
                </p>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* PDF Modal */}
      {showPDFModal && (
        <div style={{
          position: 'absolute',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0,0,0,0.7)',
          zIndex: 2000,
          display: 'flex',
          alignItems: 'flex-start',
          justifyContent: 'center',
          padding: '20px',
          paddingTop: '40px',
          backdropFilter: 'blur(8px)',
          overflowY: 'auto'
        }} onClick={() => setShowPDFModal(false)}>
          <div style={{
            background: '#fff',
            borderRadius: '20px',
            maxWidth: '700px',
            width: '100%',
            maxHeight: '90vh',
            overflow: 'hidden',
            display: 'flex',
            flexDirection: 'column',
            boxShadow: '0 25px 70px rgba(0,0,0,0.5)'
          }} onClick={(e) => e.stopPropagation()}>
            <div style={{padding: '24px 28px', background: 'var(--emerald)', borderBottom: '1px solid var(--border)', display: 'flex', alignItems: 'center', justifyContent: 'space-between'}}>
              <div style={{fontSize: '24px', fontWeight: '800', color: 'white'}}>ğŸ“„ Descargar PDF Worksheets</div>
              <button onClick={() => setShowPDFModal(false)} style={{background: 'rgba(255,255,255,0.2)', border: 'none', width: '36px', height: '36px', borderRadius: '50%', fontSize: '22px', cursor: 'pointer', color: 'white'}}>Ã—</button>
            </div>
            <div style={{padding: '32px', overflowY: 'auto'}}>
              <p style={{color: 'var(--text-muted)', marginBottom: '24px', fontSize: '15px', lineHeight: '1.6'}}>
                Descarga los worksheets en PDF para llenar tus datos financieros de forma detallada. Luego ingresa solo los <strong>TOTALES</strong> en la calculadora.
              </p>

              <div style={{display: 'flex', flexDirection: 'column', gap: '16px'}}>
                {/* PDF 1: Ingresos y Gastos */}
                <div style={{
                  background: 'white',
                  border: '2px solid var(--border)',
                  borderRadius: '12px',
                  padding: '20px',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  transition: 'all 0.2s',
                  cursor: 'pointer'
                }}
                onMouseEnter={(e) => e.currentTarget.style.borderColor = 'var(--emerald)'}
                onMouseLeave={(e) => e.currentTarget.style.borderColor = 'var(--border)'}
                >
                  <div style={{flex: 1}}>
                    <div style={{fontWeight: '700', fontSize: '16px', marginBottom: '4px', color: 'var(--text)'}}>
                      ğŸ’µ Ingresos y Gastos
                    </div>
                    <div style={{fontSize: '13px', color: 'var(--text-muted)'}}>
                      Desglose detallado de flujo de caja
                    </div>
                  </div>
                  <a 
                    href="https://51fe6aff-6c63-452e-ae29-61aa710bd777.usrfiles.com/ugd/51fe6a_dab0ffbb1c2e4187bcf10787e8a86a9b.pdf" 
                    target="_blank"
                    rel="noopener noreferrer"
                    style={{
                      padding: '10px 20px',
                      background: 'var(--emerald)',
                      color: 'white',
                      borderRadius: '8px',
                      textDecoration: 'none',
                      fontWeight: '600',
                      fontSize: '14px',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}
                  >
                    â¬‡ï¸ Descargar
                  </a>
                </div>

                {/* PDF 2: Activos */}
                <div style={{
                  background: 'white',
                  border: '2px solid var(--border)',
                  borderRadius: '12px',
                  padding: '20px',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  transition: 'all 0.2s',
                  cursor: 'pointer'
                }}
                onMouseEnter={(e) => e.currentTarget.style.borderColor = 'var(--emerald)'}
                onMouseLeave={(e) => e.currentTarget.style.borderColor = 'var(--border)'}
                >
                  <div style={{flex: 1}}>
                    <div style={{fontWeight: '700', fontSize: '16px', marginBottom: '4px', color: 'var(--text)'}}>
                      ğŸ’° Activos
                    </div>
                    <div style={{fontSize: '13px', color: 'var(--text-muted)'}}>
                      Inventario completo de tus activos
                    </div>
                  </div>
                  <a 
                    href="https://51fe6aff-6c63-452e-ae29-61aa710bd777.usrfiles.com/ugd/51fe6a_b0e0da8a0823447692c16e04b8eee03a.pdf" 
                    target="_blank"
                    rel="noopener noreferrer"
                    style={{
                      padding: '10px 20px',
                      background: 'var(--emerald)',
                      color: 'white',
                      borderRadius: '8px',
                      textDecoration: 'none',
                      fontWeight: '600',
                      fontSize: '14px',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}
                  >
                    â¬‡ï¸ Descargar
                  </a>
                </div>

                {/* PDF 3: Pasivos */}
                <div style={{
                  background: 'white',
                  border: '2px solid var(--border)',
                  borderRadius: '12px',
                  padding: '20px',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  transition: 'all 0.2s',
                  cursor: 'pointer'
                }}
                onMouseEnter={(e) => e.currentTarget.style.borderColor = 'var(--emerald)'}
                onMouseLeave={(e) => e.currentTarget.style.borderColor = 'var(--border)'}
                >
                  <div style={{flex: 1}}>
                    <div style={{fontWeight: '700', fontSize: '16px', marginBottom: '4px', color: 'var(--text)'}}>
                      ğŸ’³ Pasivos
                    </div>
                    <div style={{fontSize: '13px', color: 'var(--text-muted)'}}>
                      Inventario completo de tus deudas
                    </div>
                  </div>
                  <a 
                    href="https://51fe6aff-6c63-452e-ae29-61aa710bd777.usrfiles.com/ugd/51fe6a_da33d073988e43c8badae5c178c58e56.pdf" 
                    target="_blank"
                    rel="noopener noreferrer"
                    style={{
                      padding: '10px 20px',
                      background: 'var(--emerald)',
                      color: 'white',
                      borderRadius: '8px',
                      textDecoration: 'none',
                      fontWeight: '600',
                      fontSize: '14px',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}
                  >
                    â¬‡ï¸ Descargar
                  </a>
                </div>
              </div>

              <div style={{background: '#f0f9ff', padding: '16px', borderRadius: '12px', borderLeft: '4px solid var(--emerald)', marginTop: '24px'}}>
                <p style={{margin: 0, fontSize: '14px', lineHeight: '1.6', color: 'var(--text)'}}>
                  <strong>ğŸ’¡ Tip:</strong> Descarga los PDFs, imprÃ­melos y llÃ©nalos con calma. Luego usa esta calculadora solo para ingresar los totales y ver tus resultados visuales.
                </p>
              </div>
            </div>
          </div>
        </div>
      )}



      <footer className="export-footer">
        <div className="export-footer-content">
          <div className="export-info">
            <div className="font-bold">
              {userProfile.nombre && userProfile.apellido 
                ? `Money Map de ${userProfile.nombre} ${userProfile.apellido}`
                : userProfile.nombre
                ? `Money Map de ${userProfile.nombre}`
                : 'Xavier Serbia Money Map'}
            </div>
            <div className="text-muted" style={{fontSize: '0.85rem', marginTop: '0.25rem'}}>
              Patrimonio Neto: <span className="currency font-bold" style={{color: totales.patrimonioNeto >= 0 ? 'var(--success)' : 'var(--danger)'}}>
                {formatCurrency(totales.patrimonioNeto, currency)}
              </span>
            </div>
            <div style={{fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '0.5rem'}}>
              Esta herramienta proporciona anÃ¡lisis financiero educativo. No constituye asesoramiento financiero, legal o fiscal profesional. 
              Consulta con profesionales calificados para decisiones financieras importantes.
            </div>
          </div>
        </div>
      </footer>
    </div>
  );
}

// ============= DATOS TAB =============
function DatosTab({ 
  modoCalculo, setModoCalculo,
  ingresoBruto, setIngresoBruto,
  ahorro, setAhorro,
  deudas, setDeudas,
  gastosDiarios, setGastosDiarios,
  seguros, setSeguros,
  impuestos, setImpuestos,
  efectivo, setEfectivo,
  inversiones, setInversiones,
  retiro, setRetiro,
  bienesRaices, setBienesRaices,
  bienesPersonales, setBienesPersonales,
  tarjetas, setTarjetas,
  lineaPersonal, setLineaPersonal,
  lineaPropiedad, setLineaPropiedad,
  hipoteca, setHipoteca,
  prestamoAuto, setPrestamoAuto,
  prestamosEducativos, setPrestamosEducativos,
  otrosPrestamos, setOtrosPrestamos,
  gastosEsenciales, setGastosEsenciales,
  reservaEmergencia, setReservaEmergencia,
  pagoMensualDeudas, setPagoMensualDeudas,
  currency
}) {
  return (
    <div>
      {/* Modo de cÃ¡lculo */}
      <div className="card">
        <div className="card-header">
          <div>
            <h2 className="card-title">Modo de CÃ¡lculo</h2>
            <p className="card-subtitle">Elige si prefieres ingresar datos mensuales o anuales</p>
          </div>
          <select 
            className="form-input" 
            style={{width: 'auto'}}
            value={modoCalculo}
            onChange={(e) => setModoCalculo(e.target.value)}
          >
            <option value="mensual">Mensual</option>
            <option value="anual">Anual</option>
          </select>
        </div>
      </div>

      {/* Flujo de Caja */}
      <div className="card">
        <div className="card-header">
          <div>
            <h2 className="card-title">ğŸ’µ Flujo de Caja ({modoCalculo === 'mensual' ? 'Mensual' : 'Anual'})</h2>
            <p className="card-subtitle">Usa el PDF Worksheet para calcular estos totales</p>
          </div>
        </div>

        <div className="grid-3">
          <div className="form-group">
            <label className="form-label">Ingreso Bruto Total</label>
            <input
              type="number"
              className="form-input"
              placeholder={`${formatCurrency(0, currency)} ${modoCalculo === 'mensual' ? '/mes' : '/aÃ±o'}`}
              value={ingresoBruto}
              onChange={(e) => setIngresoBruto(e.target.value)}
            />
          </div>

          <div className="form-group">
            <label className="form-label">Ahorro Total</label>
            <input
              type="number"
              className="form-input"
              placeholder={`${formatCurrency(0, currency)} ${modoCalculo === 'mensual' ? '/mes' : '/aÃ±o'}`}
              value={ahorro}
              onChange={(e) => setAhorro(e.target.value)}
            />
          </div>

          <div className="form-group">
            <label className="form-label">Deudas Total (pago)</label>
            <input
              type="number"
              className="form-input"
              placeholder={`${formatCurrency(0, currency)} ${modoCalculo === 'mensual' ? '/mes' : '/aÃ±o'}`}
              value={deudas}
              onChange={(e) => setDeudas(e.target.value)}
            />
            <div style={{fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '0.25rem'}}>
              Total de pagos mensuales/anuales de todas tus deudas (se usa para calcular DTI)
            </div>
          </div>

          <div className="form-group">
            <label className="form-label">Gastos Diarios Total</label>
            <input
              type="number"
              className="form-input"
              placeholder={`${formatCurrency(0, currency)} ${modoCalculo === 'mensual' ? '/mes' : '/aÃ±o'}`}
              value={gastosDiarios}
              onChange={(e) => setGastosDiarios(e.target.value)}
            />
          </div>

          <div className="form-group">
            <label className="form-label">Seguros Total</label>
            <input
              type="number"
              className="form-input"
              placeholder={`${formatCurrency(0, currency)} ${modoCalculo === 'mensual' ? '/mes' : '/aÃ±o'}`}
              value={seguros}
              onChange={(e) => setSeguros(e.target.value)}
            />
          </div>

          <div className="form-group">
            <label className="form-label">Impuestos Total</label>
            <input
              type="number"
              className="form-input"
              placeholder={`${formatCurrency(0, currency)} ${modoCalculo === 'mensual' ? '/mes' : '/aÃ±o'}`}
              value={impuestos}
              onChange={(e) => setImpuestos(e.target.value)}
            />
          </div>
        </div>
      </div>

      {/* Activos */}
      <div className="card">
        <div className="card-header">
          <div>
            <h2 className="card-title">ğŸ’° Activos (Valor Total)</h2>
            <p className="card-subtitle">Usa el PDF Worksheet para calcular estos totales</p>
          </div>
        </div>

        <div className="grid-3">
          <div className="form-group">
            <label className="form-label">Efectivo y Equivalentes</label>
            <input
              type="number"
              className="form-input"
              placeholder={formatCurrency(0, currency)}
              value={efectivo}
              onChange={(e) => setEfectivo(e.target.value)}
            />
          </div>

          <div className="form-group">
            <label className="form-label">Inversiones</label>
            <input
              type="number"
              className="form-input"
              placeholder={formatCurrency(0, currency)}
              value={inversiones}
              onChange={(e) => setInversiones(e.target.value)}
            />
          </div>

          <div className="form-group">
            <label className="form-label">Cuentas de Retiro</label>
            <input
              type="number"
              className="form-input"
              placeholder={formatCurrency(0, currency)}
              value={retiro}
              onChange={(e) => setRetiro(e.target.value)}
            />
          </div>

          <div className="form-group">
            <label className="form-label">Bienes RaÃ­ces</label>
            <input
              type="number"
              className="form-input"
              placeholder={formatCurrency(0, currency)}
              value={bienesRaices}
              onChange={(e) => setBienesRaices(e.target.value)}
            />
          </div>

          <div className="form-group">
            <label className="form-label">Bienes Personales</label>
            <input
              type="number"
              className="form-input"
              placeholder={formatCurrency(0, currency)}
              value={bienesPersonales}
              onChange={(e) => setBienesPersonales(e.target.value)}
            />
          </div>
        </div>
      </div>

      {/* Pasivos */}
      <div className="card">
        <div className="card-header">
          <div>
            <h2 className="card-title">ğŸ’³ Pasivos (Balance Total)</h2>
            <p className="card-subtitle">Usa el PDF Worksheet para calcular estos totales</p>
          </div>
        </div>

        <div className="grid-3">
          <div className="form-group">
            <label className="form-label">Tarjetas de CrÃ©dito</label>
            <input
              type="number"
              className="form-input"
              placeholder={formatCurrency(0, currency)}
              value={tarjetas}
              onChange={(e) => setTarjetas(e.target.value)}
            />
          </div>

          <div className="form-group">
            <label className="form-label">LÃ­nea de CrÃ©dito Personal</label>
            <input
              type="number"
              className="form-input"
              placeholder={formatCurrency(0, currency)}
              value={lineaPersonal}
              onChange={(e) => setLineaPersonal(e.target.value)}
            />
          </div>

          <div className="form-group">
            <label className="form-label">LÃ­nea de CrÃ©dito de Propiedad</label>
            <input
              type="number"
              className="form-input"
              placeholder={formatCurrency(0, currency)}
              value={lineaPropiedad}
              onChange={(e) => setLineaPropiedad(e.target.value)}
            />
          </div>

          <div className="form-group">
            <label className="form-label">Hipoteca/Casa</label>
            <input
              type="number"
              className="form-input"
              placeholder={formatCurrency(0, currency)}
              value={hipoteca}
              onChange={(e) => setHipoteca(e.target.value)}
            />
          </div>

          <div className="form-group">
            <label className="form-label">PrÃ©stamo de Auto</label>
            <input
              type="number"
              className="form-input"
              placeholder={formatCurrency(0, currency)}
              value={prestamoAuto}
              onChange={(e) => setPrestamoAuto(e.target.value)}
            />
          </div>

          <div className="form-group">
            <label className="form-label">PrÃ©stamos Educativos</label>
            <input
              type="number"
              className="form-input"
              placeholder={formatCurrency(0, currency)}
              value={prestamosEducativos}
              onChange={(e) => setPrestamosEducativos(e.target.value)}
            />
          </div>

          <div className="form-group">
            <label className="form-label">Otros PrÃ©stamos</label>
            <input
              type="number"
              className="form-input"
              placeholder={formatCurrency(0, currency)}
              value={otrosPrestamos}
              onChange={(e) => setOtrosPrestamos(e.target.value)}
            />
          </div>
        </div>
      </div>

      {/* Datos adicionales para ratios */}
      <div className="card">
        <div className="card-header">
          <div>
            <h2 className="card-title">ğŸ“Š Datos Adicionales para Ratios</h2>
            <p className="card-subtitle">Estos datos ayudan a calcular tus ratios financieros</p>
          </div>
        </div>

        <div className="grid-2">
          <div className="form-group">
            <label className="form-label">Gastos Esenciales Mensuales</label>
            <input
              type="number"
              className="form-input"
              placeholder={`${formatCurrency(0, currency)}/mes`}
              value={gastosEsenciales}
              onChange={(e) => setGastosEsenciales(e.target.value)}
            />
            <div style={{fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '0.25rem'}}>
              Para calcular meses de reserva
            </div>
          </div>

          <div className="form-group">
            <label className="form-label">Reserva de Emergencia</label>
            <input
              type="number"
              className="form-input"
              placeholder={formatCurrency(0, currency)}
              value={reservaEmergencia}
              onChange={(e) => setReservaEmergencia(e.target.value)}
            />
            <div style={{fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '0.25rem'}}>
              Efectivo disponible para emergencias
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

// ============= VISTA GENERAL =============
function VistaGeneral({ totales, userProfile, currency, setActiveTab }) {
  const mult = 1; // Always annual in calculations
  
  const ingresoBruto = totales.totalIngresos;
  const ingresoNeto = totales.totalIngresos - totales.totalGastos - totales.totalAhorro;
  const mesesReserva = totales.totalEfectivo > 0 && totales.totalGastos > 0 ? (totales.totalEfectivo / (totales.totalGastos / 12)) : 0;
  const tasaAhorro = ingresoBruto > 0 ? totales.totalAhorro / ingresoBruto : 0;
  const deudaActivos = totales.activosTotales > 0 ? totales.pasivosTotales / totales.activosTotales : 0;
  const patrimonioActivos = totales.activosTotales > 0 ? totales.patrimonioNeto / totales.activosTotales : 0;

  return (
    <div style={{padding: '2rem', maxWidth: '1600px', margin: '0 auto'}}>
      <div style={{display: 'flex', gap: '2rem', alignItems: 'flex-start', flexWrap: 'wrap'}}>
        
        {/* Left: Data Summary */}
        <div style={{flex: '0 0 340px', display: 'flex', flexDirection: 'column', gap: '1.5rem', minWidth: '300px'}}>
          <h2 style={{fontSize: '1.5rem', fontWeight: '800', color: '#333', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
            ğŸ“Š Resumen Financiero
          </h2>
          
          {/* Flujo de Caja */}
          <div style={{background: 'white', borderRadius: '16px', padding: '1.5rem', boxShadow: '0 4px 12px rgba(0,0,0,0.1)'}}>
            <h3 style={{fontWeight: '700', marginBottom: '1rem', color: '#3b82f6', fontSize: '1rem'}}>Flujo de Caja (Anual)</h3>
            <div style={{display: 'flex', flexDirection: 'column', gap: '0.75rem'}}>
              <div style={{display: 'flex', justifyContent: 'space-between', padding: '0.75rem', background: '#f0fdf4', borderRadius: '8px', cursor: 'pointer'}} onClick={() => setActiveTab('datos')}>
                <span style={{color: '#666', fontSize: '0.9rem'}}>Ingresos</span>
                <span style={{fontWeight: '700', color: '#10b981'}}>{formatCurrency(totales.totalIngresos, currency)}</span>
              </div>
              <div style={{display: 'flex', justifyContent: 'space-between', padding: '0.75rem', background: '#fef2f2', borderRadius: '8px', cursor: 'pointer'}} onClick={() => setActiveTab('datos')}>
                <span style={{color: '#666', fontSize: '0.9rem'}}>Gastos</span>
                <span style={{fontWeight: '700', color: '#ef4444'}}>{formatCurrency(totales.totalGastos, currency)}</span>
              </div>
              <div style={{display: 'flex', justifyContent: 'space-between', padding: '0.75rem', background: '#f0fdf4', borderRadius: '8px', cursor: 'pointer'}} onClick={() => setActiveTab('datos')}>
                <span style={{color: '#666', fontSize: '0.9rem'}}>Ahorro</span>
                <span style={{fontWeight: '700', color: '#10b981'}}>{formatCurrency(totales.totalAhorro, currency)}</span>
              </div>
              <div style={{display: 'flex', justifyContent: 'space-between', padding: '0.75rem', background: totales.superavit >= 0 ? '#f0fdf4' : '#fef2f2', borderRadius: '8px', border: `2px solid ${totales.superavit >= 0 ? '#10b981' : '#ef4444'}`}}>
                <span style={{color: '#666', fontWeight: '600', fontSize: '0.9rem'}}>{totales.superavit >= 0 ? 'SuperÃ¡vit' : 'DÃ©ficit'}</span>
                <span style={{fontWeight: '700', color: totales.superavit >= 0 ? '#10b981' : '#ef4444', fontSize: '1.1rem'}}>{formatCurrency(Math.abs(totales.superavit), currency)}</span>
              </div>
            </div>
          </div>

          {/* Balance General */}
          <div style={{background: 'white', borderRadius: '16px', padding: '1.5rem', boxShadow: '0 4px 12px rgba(0,0,0,0.1)'}}>
            <h3 style={{fontWeight: '700', marginBottom: '1rem', color: '#3b82f6', fontSize: '1rem'}}>Balance General</h3>
            <div style={{display: 'flex', flexDirection: 'column', gap: '0.75rem'}}>
              <div style={{display: 'flex', justifyContent: 'space-between', padding: '0.75rem', background: '#f0fdf4', borderRadius: '8px', cursor: 'pointer'}} onClick={() => setActiveTab('datos')}>
                <span style={{color: '#666', fontSize: '0.9rem'}}>Activos</span>
                <span style={{fontWeight: '700', color: '#10b981'}}>{formatCurrency(totales.activosTotales, currency)}</span>
              </div>
              <div style={{display: 'flex', justifyContent: 'space-between', padding: '0.75rem', background: '#fef2f2', borderRadius: '8px', cursor: 'pointer'}} onClick={() => setActiveTab('datos')}>
                <span style={{color: '#666', fontSize: '0.9rem'}}>Pasivos</span>
                <span style={{fontWeight: '700', color: '#ef4444'}}>{formatCurrency(totales.pasivosTotales, currency)}</span>
              </div>
              <div style={{display: 'flex', justifyContent: 'space-between', padding: '0.75rem', background: totales.patrimonioNeto >= 0 ? '#f0fdf4' : '#fef2f2', borderRadius: '8px', border: `3px solid ${totales.patrimonioNeto >= 0 ? '#10b981' : '#ef4444'}`, cursor: 'pointer'}} onClick={() => setActiveTab('datos')}>
                <span style={{color: '#666', fontWeight: '600', fontSize: '0.9rem'}}>Patrimonio Neto</span>
                <span style={{fontWeight: '700', color: totales.patrimonioNeto >= 0 ? '#10b981' : '#ef4444', fontSize: '1.25rem'}}>{formatCurrency(totales.patrimonioNeto, currency)}</span>
              </div>
            </div>
          </div>
        </div>

        {/* Center: Person Icon */}
        <div style={{flex: '0 0 280px', display: 'flex', alignItems: 'center', justifyContent: 'center', minHeight: '400px', minWidth: '200px'}}>
          <div style={{display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '1rem'}}>
            
            {/* Avatar(s) */}
            {(userProfile.estadoCivil === 'casado' || userProfile.estadoCivil === 'pareja') && userProfile.parejaNombre ? (
              // Couple avatars
              <div style={{display: 'flex', gap: '1rem', alignItems: 'center'}}>
                <div style={{
                  width: '100px', 
                  height: '100px', 
                  background: 'linear-gradient(135deg, var(--primary) 0%, #2563eb 100%)', 
                  borderRadius: '50%',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  fontSize: '3rem',
                  boxShadow: '0 8px 24px rgba(59, 130, 246, 0.3)',
                  border: '4px solid white'
                }}>
                  {userProfile.avatar}
                </div>
                <div style={{fontSize: '2rem', color: 'var(--primary)'}}>â¤ï¸</div>
                <div style={{
                  width: '100px', 
                  height: '100px', 
                  background: 'linear-gradient(135deg, #ec4899 0%, #db2777 100%)', 
                  borderRadius: '50%',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  fontSize: '3rem',
                  boxShadow: '0 8px 24px rgba(236, 72, 153, 0.3)',
                  border: '4px solid white'
                }}>
                  {userProfile.parejaAvatar || 'ğŸ‘¤'}
                </div>
              </div>
            ) : (
              // Single avatar
              <div style={{
                width: '120px', 
                height: '120px', 
                background: 'linear-gradient(135deg, var(--primary) 0%, #2563eb 100%)', 
                borderRadius: '50%',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                fontSize: '4rem',
                boxShadow: '0 8px 24px rgba(59, 130, 246, 0.3)',
                border: '4px solid white'
              }}>
                {userProfile.avatar}
              </div>
            )}
            
            {/* Names and Info */}
            <div style={{textAlign: 'center'}}>
              {(userProfile.estadoCivil === 'casado' || userProfile.estadoCivil === 'pareja') && userProfile.parejaNombre ? (
                // Couple names
                <div>
                  <div style={{fontWeight: '800', color: '#333', fontSize: '1.1rem', marginBottom: '0.25rem'}}>
                    {userProfile.nombre && userProfile.apellido 
                      ? `${userProfile.nombre} ${userProfile.apellido}` 
                      : 'Usuario 1'}
                  </div>
                  <div style={{color: 'var(--text-muted)', fontSize: '0.85rem', marginBottom: '0.5rem'}}>y</div>
                  <div style={{fontWeight: '800', color: '#333', fontSize: '1.1rem', marginBottom: '0.25rem'}}>
                    {userProfile.parejaNombre && userProfile.parejaApellido 
                      ? `${userProfile.parejaNombre} ${userProfile.parejaApellido}` 
                      : 'Usuario 2'}
                  </div>
                </div>
              ) : (
                // Single name
                <div style={{fontWeight: '800', color: '#333', fontSize: '1.25rem', marginBottom: '0.25rem'}}>
                  {userProfile.nombre && userProfile.apellido 
                    ? `${userProfile.nombre} ${userProfile.apellido}` 
                    : 'Usuario'}
                </div>
              )}
              
              {userProfile.edad && (
                <div style={{color: 'var(--text-muted)', fontSize: '0.9rem', marginTop: '0.5rem'}}>
                  {userProfile.edad} aÃ±os
                  {userProfile.dependientes > 0 && (
                    <div style={{marginTop: '0.5rem', fontSize: '1.5rem'}}>
                      {'ğŸ‘¶'.repeat(Math.min(userProfile.dependientes, 5))}
                      {userProfile.dependientes > 5 && ` +${userProfile.dependientes - 5}`}
                    </div>
                  )}
                </div>
              )}
              
              {(userProfile.estadoCivil === 'casado' || userProfile.estadoCivil === 'pareja') && userProfile.parejaNombre && (
                <div style={{
                  background: '#eff6ff',
                  color: 'var(--primary)',
                  padding: '0.4rem 0.75rem',
                  borderRadius: '999px',
                  fontSize: '0.75rem',
                  fontWeight: '700',
                  marginTop: '0.5rem',
                  display: 'inline-block'
                }}>
                  ğŸ’‘ AnÃ¡lisis Conjunto
                </div>
              )}
            </div>
          </div>
        </div>

        {/* Right: Ratio Analysis */}
        <div style={{flex: '1', display: 'flex', flexDirection: 'column', gap: '1.5rem', minWidth: '380px'}}>
          <h2 style={{fontSize: '1.5rem', fontWeight: '800', color: '#333', marginBottom: '0.5rem'}}>ğŸ¯ AnÃ¡lisis de Ratios</h2>
          
          {/* Liquidez */}
          <div style={{background: 'white', borderRadius: '16px', padding: '1.5rem', boxShadow: '0 4px 12px rgba(0,0,0,0.1)', cursor: 'pointer'}} onClick={() => setActiveTab('ratios')}>
            <div style={{background: '#3b82f6', color: 'white', padding: '0.5rem 1rem', borderRadius: '8px', fontWeight: '700', fontSize: '0.875rem', marginBottom: '1rem', textTransform: 'uppercase', letterSpacing: '0.5px'}}>
              ğŸ’§ Liquidez
            </div>
            <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem'}}>
              <div style={{textAlign: 'center'}}>
                <div style={{fontSize: '0.75rem', color: '#666', marginBottom: '0.5rem'}}>Meses de reserva</div>
                <div style={{fontSize: '1.5rem', fontWeight: '800', color: '#333'}}>{isFinite(mesesReserva) ? mesesReserva.toFixed(1) + 'm' : 'â€”'}</div>
                <div style={{fontSize: '1.25rem', marginTop: '0.25rem'}}>{mesesReserva >= 6 ? 'âœ…' : mesesReserva >= 3 ? 'âš ï¸' : 'ğŸš¨'}</div>
              </div>
              <div style={{textAlign: 'center'}}>
                <div style={{fontSize: '0.75rem', color: '#666', marginBottom: '0.5rem'}}>Ver detalles â†’</div>
                <div style={{fontSize: '1rem', fontWeight: '700', color: '#3b82f6', marginTop: '1rem'}}>MÃ¡s ratios</div>
              </div>
            </div>
          </div>

          {/* Ahorro */}
          <div style={{background: 'white', borderRadius: '16px', padding: '1.5rem', boxShadow: '0 4px 12px rgba(0,0,0,0.1)', cursor: 'pointer'}} onClick={() => setActiveTab('ratios')}>
            <div style={{background: '#3b82f6', color: 'white', padding: '0.5rem 1rem', borderRadius: '8px', fontWeight: '700', fontSize: '0.875rem', marginBottom: '1rem', textTransform: 'uppercase', letterSpacing: '0.5px'}}>
              ğŸ· Ahorro
            </div>
            <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem'}}>
              <div style={{textAlign: 'center'}}>
                <div style={{fontSize: '0.75rem', color: '#666', marginBottom: '0.5rem'}}>Tasa de ahorro</div>
                <div style={{fontSize: '1.5rem', fontWeight: '800', color: '#333'}}>{isFinite(tasaAhorro) ? (tasaAhorro * 100).toFixed(1) + '%' : 'â€”'}</div>
                <div style={{fontSize: '1.25rem', marginTop: '0.25rem'}}>{tasaAhorro >= 0.30 ? 'âœ…' : tasaAhorro >= 0.15 ? 'âš ï¸' : 'ğŸš¨'}</div>
              </div>
              <div style={{textAlign: 'center'}}>
                <div style={{fontSize: '0.75rem', color: '#666', marginBottom: '0.5rem'}}>Ver detalles â†’</div>
                <div style={{fontSize: '1rem', fontWeight: '700', color: '#3b82f6', marginTop: '1rem'}}>MÃ¡s ratios</div>
              </div>
            </div>
          </div>

          {/* Deuda */}
          <div style={{background: 'white', borderRadius: '16px', padding: '1.5rem', boxShadow: '0 4px 12px rgba(0,0,0,0.1)', cursor: 'pointer'}} onClick={() => setActiveTab('ratios')}>
            <div style={{background: '#3b82f6', color: 'white', padding: '0.5rem 1rem', borderRadius: '8px', fontWeight: '700', fontSize: '0.875rem', marginBottom: '1rem', textTransform: 'uppercase', letterSpacing: '0.5px'}}>
              ğŸ¦ Deuda
            </div>
            <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem'}}>
              <div style={{textAlign: 'center'}}>
                <div style={{fontSize: '0.75rem', color: '#666', marginBottom: '0.5rem'}}>Pasivos / Activos</div>
                <div style={{fontSize: '1.5rem', fontWeight: '800', color: '#333'}}>{isFinite(deudaActivos) ? (deudaActivos * 100).toFixed(1) + '%' : 'â€”'}</div>
                <div style={{fontSize: '1.25rem', marginTop: '0.25rem'}}>{deudaActivos > 0.50 ? 'ğŸš¨' : deudaActivos >= 0.30 ? 'âš ï¸' : 'âœ…'}</div>
              </div>
              <div style={{textAlign: 'center'}}>
                <div style={{fontSize: '0.75rem', color: '#666', marginBottom: '0.5rem'}}>Ver detalles â†’</div>
                <div style={{fontSize: '1rem', fontWeight: '700', color: '#3b82f6', marginTop: '1rem'}}>MÃ¡s ratios</div>
              </div>
            </div>
          </div>

          {/* Patrimonio */}
          <div style={{background: 'white', borderRadius: '16px', padding: '1.5rem', boxShadow: '0 4px 12px rgba(0,0,0,0.1)', cursor: 'pointer'}} onClick={() => setActiveTab('ratios')}>
            <div style={{background: '#3b82f6', color: 'white', padding: '0.5rem 1rem', borderRadius: '8px', fontWeight: '700', fontSize: '0.875rem', marginBottom: '1rem', textTransform: 'uppercase', letterSpacing: '0.5px'}}>
              ğŸ’ Patrimonio
            </div>
            <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem'}}>
              <div style={{textAlign: 'center'}}>
                <div style={{fontSize: '0.75rem', color: '#666', marginBottom: '0.5rem'}}>Patrimonio / Activos</div>
                <div style={{fontSize: '1.5rem', fontWeight: '800', color: '#333'}}>{isFinite(patrimonioActivos) ? (patrimonioActivos * 100).toFixed(1) + '%' : 'â€”'}</div>
                <div style={{fontSize: '1.25rem', marginTop: '0.25rem'}}>{patrimonioActivos >= 0.70 ? 'âœ…' : patrimonioActivos >= 0.50 ? 'âš ï¸' : 'ğŸš¨'}</div>
              </div>
              <div style={{textAlign: 'center'}}>
                <div style={{fontSize: '0.75rem', color: '#666', marginBottom: '0.5rem'}}>Ver todos los ratios â†’</div>
                <div style={{fontSize: '1rem', fontWeight: '700', color: '#3b82f6', marginTop: '1rem'}}>MÃ¡s detalles</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

// ============= GRÃFICOS TAB =============
function GraficosTab({ totales, currency, ingresoBruto, ahorro, deudas, gastosDiarios, seguros, impuestos, modoCalculo, tarjetas, lineaPersonal, lineaPropiedad, hipoteca, prestamoAuto, prestamosEducativos, otrosPrestamos }) {
  const [retornoAnual, setRetornoAnual] = useState(7);
  
  useEffect(() => {
    // Destroy existing charts
    const chartIds = ['pieActivos', 'pieGastos', 'barIngresosGastos', 'donutAssetAllocation', 'lineProyeccion'];
    chartIds.forEach(id => {
      const existingChart = Chart.getChart(id);
      if (existingChart) {
        existingChart.destroy();
      }
    });

    const mult = modoCalculo === 'anual' ? 1 : 12;
    const totalIngresos = ingresoBruto * mult;
    const totalAhorro = ahorro * mult;
    const totalDeudas = deudas * mult;
    const totalGastosDiarios = gastosDiarios * mult;
    const totalSeguros = seguros * mult;
    const totalImpuestos = impuestos * mult;
    const totalGastos = totalDeudas + totalGastosDiarios + totalSeguros + totalImpuestos;

    // 1. PIE CHART - DistribuciÃ³n de Activos
    if (totales.activosTotales > 0) {
      const ctxActivos = document.getElementById('pieActivos');
      if (ctxActivos) {
        // Filtrar solo categorÃ­as con valores > 0
        const categorias = [
          { label: 'Efectivo', value: totales.totalEfectivo, color: '#10b981' },
          { label: 'Inversiones', value: totales.totalInversiones, color: '#3b82f6' },
          { label: 'Retiro', value: totales.totalRetiro, color: '#8b5cf6' },
          { label: 'Bienes RaÃ­ces', value: totales.totalBienesRaices, color: '#f59e0b' },
          { label: 'Bienes Personales', value: totales.totalBienesPersonales, color: '#ec4899' }
        ].filter(cat => cat.value > 0);
        
        new Chart(ctxActivos, {
          type: 'pie',
          data: {
            labels: categorias.map(c => c.label),
            datasets: [{
              data: categorias.map(c => c.value),
              backgroundColor: categorias.map(c => c.color),
              borderWidth: 2,
              borderColor: '#fff'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: { position: 'bottom', labels: { padding: 15, font: { size: 12 } } },
              title: { display: true, text: 'DistribuciÃ³n de Activos', font: { size: 16, weight: 'bold' } },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = context.parsed || 0;
                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                    const percentage = ((value / total) * 100).toFixed(1);
                    return `${label}: ${formatCurrency(value, currency)} (${percentage}%)`;
                  }
                }
              }
            }
          }
        });
      }
    }

    // 2. PIE CHART - DistribuciÃ³n de Gastos
    if (totalGastos > 0) {
      const ctxGastos = document.getElementById('pieGastos');
      if (ctxGastos) {
        // Filtrar solo categorÃ­as con valores > 0
        const categorias = [
          { label: 'Gastos Diarios', value: totalGastosDiarios, color: '#ef4444' },
          { label: 'Pagos de Deuda', value: totalDeudas, color: '#f59e0b' },
          { label: 'Impuestos', value: totalImpuestos, color: '#eab308' },
          { label: 'Seguros', value: totalSeguros, color: '#06b6d4' }
        ].filter(cat => cat.value > 0);
        
        new Chart(ctxGastos, {
          type: 'pie',
          data: {
            labels: categorias.map(c => c.label),
            datasets: [{
              data: categorias.map(c => c.value),
              backgroundColor: categorias.map(c => c.color),
              borderWidth: 2,
              borderColor: '#fff'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: { position: 'bottom', labels: { padding: 15, font: { size: 12 } } },
              title: { display: true, text: 'DistribuciÃ³n de Gastos Anuales', font: { size: 16, weight: 'bold' } },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = context.parsed || 0;
                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                    const percentage = ((value / total) * 100).toFixed(1);
                    return `${label}: ${formatCurrency(value, currency)} (${percentage}%)`;
                  }
                }
              }
            }
          }
        });
      }
    }

    // 3. BAR CHART - Activos vs Pasivos vs Patrimonio
    const ctxBar = document.getElementById('barIngresosGastos');
    if (ctxBar) {
      new Chart(ctxBar, {
        type: 'bar',
        data: {
          labels: ['Activos', 'Pasivos', 'Patrimonio Neto'],
          datasets: [{
            label: 'Balance General',
            data: [totales.activosTotales, totales.pasivosTotales, totales.patrimonioNeto],
            backgroundColor: ['rgba(16, 185, 129, 0.8)', 'rgba(239, 68, 68, 0.8)', 'rgba(59, 130, 246, 0.8)'],
            borderColor: ['rgb(16, 185, 129)', 'rgb(239, 68, 68)', 'rgb(59, 130, 246)'],
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { display: false },
            title: { display: true, text: 'Balance General: Activos vs Pasivos vs Patrimonio', font: { size: 16, weight: 'bold' } },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return formatCurrency(context.parsed.y, currency);
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return formatCurrency(value, currency);
                }
              }
            }
          }
        }
      });
    }

    // 4. PIE CHART - DistribuciÃ³n de Pasivos
    if (totales.pasivosTotales > 0) {
      const ctxPasivos = document.getElementById('donutAssetAllocation');
      if (ctxPasivos) {
        // Filtrar solo categorÃ­as con valores > 0
        const categorias = [
          { label: 'Tarjetas', value: tarjetas, color: '#ef4444' },
          { label: 'LÃ­nea Personal', value: lineaPersonal, color: '#f59e0b' },
          { label: 'LÃ­nea Propiedad', value: lineaPropiedad, color: '#eab308' },
          { label: 'Hipoteca', value: hipoteca, color: '#f97316' },
          { label: 'PrÃ©stamo Auto', value: prestamoAuto, color: '#ec4899' },
          { label: 'PrÃ©stamos Educativos', value: prestamosEducativos, color: '#8b5cf6' },
          { label: 'Otros', value: otrosPrestamos, color: '#6366f1' }
        ].filter(cat => cat.value > 0);
        
        new Chart(ctxPasivos, {
          type: 'pie',
          data: {
            labels: categorias.map(c => c.label),
            datasets: [{
              data: categorias.map(c => c.value),
              backgroundColor: categorias.map(c => c.color),
              borderWidth: 2,
              borderColor: '#fff'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: { position: 'bottom', labels: { padding: 15, font: { size: 12 } } },
              title: { display: true, text: 'DistribuciÃ³n de Pasivos', font: { size: 16, weight: 'bold' } },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = context.parsed || 0;
                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                    const percentage = ((value / total) * 100).toFixed(1);
                    return `${label}: ${formatCurrency(value, currency)} (${percentage}%)`;
                  }
                }
              }
            }
          }
        });
      }
    }

    // 5. LINE CHART - ProyecciÃ³n de Patrimonio
    if (totales.patrimonioNeto !== 0) {
      const patrimonioActual = totales.patrimonioNeto;
      const ahorroAnual = totalAhorro;
      const retornoDecimal = retornoAnual / 100;
      
      const years = [0, 5, 10, 15, 20, 25, 30];
      const proyeccion = years.map(year => {
        if (ahorroAnual > 0) {
          // Con ahorro: Valor futuro con aportes
          const fv = patrimonioActual * Math.pow(1 + retornoDecimal, year) + 
                     ahorroAnual * ((Math.pow(1 + retornoDecimal, year) - 1) / retornoDecimal);
          return fv;
        } else {
          // Sin ahorro: Solo crecimiento del patrimonio actual
          return patrimonioActual * Math.pow(1 + retornoDecimal, year);
        }
      });
      
      const ctxLine = document.getElementById('lineProyeccion');
      if (ctxLine) {
        new Chart(ctxLine, {
          type: 'line',
          data: {
            labels: years.map(y => `AÃ±o ${y}`),
            datasets: [{
              label: 'Patrimonio Proyectado',
              data: proyeccion,
              borderColor: 'rgb(59, 130, 246)',
              backgroundColor: 'rgba(59, 130, 246, 0.1)',
              borderWidth: 3,
              fill: true,
              tension: 0.4,
              pointRadius: 5,
              pointBackgroundColor: 'rgb(59, 130, 246)',
              pointBorderColor: '#fff',
              pointBorderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: { display: false },
              title: { 
                display: true, 
                text: ahorroAnual > 0 
                  ? `ProyecciÃ³n de Patrimonio (${formatCurrency(ahorroAnual, currency)}/aÃ±o, ${retornoAnual}% retorno)` 
                  : `ProyecciÃ³n de Patrimonio (sin ahorro adicional, ${retornoAnual}% retorno)`,
                font: { size: 16, weight: 'bold' } 
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return formatCurrency(context.parsed.y, currency);
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function(value) {
                    return formatCurrency(value, currency);
                  }
                }
              }
            }
          }
        });
      }
    }

  }, [totales, currency, retornoAnual, ingresoBruto, ahorro, deudas, gastosDiarios, seguros, impuestos, modoCalculo, tarjetas, lineaPersonal, lineaPropiedad, hipoteca, prestamoAuto, prestamosEducativos, otrosPrestamos]);

  return (
    <div style={{ padding: '2rem' }}>
      <h2 style={{ fontSize: '2rem', fontWeight: '800', marginBottom: '1.5rem', color: '#1e293b' }}>
        ğŸ“ˆ AnÃ¡lisis GrÃ¡fico
      </h2>
      
      {/* Control de Retorno Anual */}
      <div style={{ 
        background: 'white', 
        padding: '1.5rem', 
        borderRadius: '12px', 
        boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
        marginBottom: '2rem'
      }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: '1.5rem', flexWrap: 'wrap' }}>
          <div style={{ flex: '1', minWidth: '200px' }}>
            <label style={{ 
              display: 'block', 
              fontSize: '0.875rem', 
              fontWeight: '600', 
              color: '#64748b',
              marginBottom: '0.5rem'
            }}>
              Retorno Anual Esperado para ProyecciÃ³n
            </label>
            <input
              type="range"
              min="0"
              max="20"
              step="0.5"
              value={retornoAnual}
              onChange={(e) => setRetornoAnual(parseFloat(e.target.value))}
              style={{
                width: '100%',
                height: '8px',
                borderRadius: '4px',
                outline: 'none',
                cursor: 'pointer'
              }}
            />
          </div>
          <div style={{
            background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',
            color: 'white',
            padding: '1rem 2rem',
            borderRadius: '12px',
            textAlign: 'center',
            minWidth: '120px'
          }}>
            <div style={{ fontSize: '0.875rem', opacity: 0.9, marginBottom: '0.25rem' }}>
              Retorno
            </div>
            <div style={{ fontSize: '2.5rem', fontWeight: '800' }}>
              {retornoAnual}%
            </div>
          </div>
        </div>
      </div>
      
      <div style={{ 
        display: 'grid', 
        gridTemplateColumns: 'repeat(auto-fit, minmax(400px, 1fr))', 
        gap: '2rem',
        marginBottom: '2rem'
      }}>
        {/* Line Chart - ProyecciÃ³n */}
        <div style={{ 
          background: 'white', 
          padding: '1.5rem', 
          borderRadius: '12px', 
          boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
          gridColumn: 'span 2'
        }}>
          <canvas id="lineProyeccion" style={{ maxHeight: '400px' }}></canvas>
        </div>
        
        {/* Pie Chart - Activos */}
        <div style={{ 
          background: 'white', 
          padding: '1.5rem', 
          borderRadius: '12px', 
          boxShadow: '0 2px 8px rgba(0,0,0,0.1)' 
        }}>
          <canvas id="pieActivos" style={{ maxHeight: '350px' }}></canvas>
        </div>

        {/* Pie Chart - Gastos */}
        <div style={{ 
          background: 'white', 
          padding: '1.5rem', 
          borderRadius: '12px', 
          boxShadow: '0 2px 8px rgba(0,0,0,0.1)' 
        }}>
          <canvas id="pieGastos" style={{ maxHeight: '350px' }}></canvas>
        </div>

        {/* Bar Chart - Ingresos vs Gastos */}
        <div style={{ 
          background: 'white', 
          padding: '1.5rem', 
          borderRadius: '12px', 
          boxShadow: '0 2px 8px rgba(0,0,0,0.1)' 
        }}>
          <canvas id="barIngresosGastos" style={{ maxHeight: '350px' }}></canvas>
        </div>

        {/* Donut Chart - Asset Allocation */}
        <div style={{ 
          background: 'white', 
          padding: '1.5rem', 
          borderRadius: '12px', 
          boxShadow: '0 2px 8px rgba(0,0,0,0.1)' 
        }}>
          <canvas id="donutAssetAllocation" style={{ maxHeight: '350px' }}></canvas>
        </div>
      </div>
    </div>
  );
}

// ============= RATIOS FINANCIEROS =============
function RatiosFinancieros({ totales, userProfile, currency, ingresoBruto, ahorro, deudas, seguros, impuestos, gastosEsenciales, reservaEmergencia, pagoMensualDeudas, modoCalculo }) {
  const [showReservaModal, setShowReservaModal] = useState(false);
  const [showBenchmarkModal, setShowBenchmarkModal] = useState(false);
  
  // Scroll to top when modals open (para embeds en Wix/iframes)
  useEffect(() => {
    if (showReservaModal || showBenchmarkModal) {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      // TambiÃ©n intentar scroll del contenedor
      const container = document.querySelector('.app-container');
      if (container) {
        container.scrollTop = 0;
      }
    }
  }, [showReservaModal, showBenchmarkModal]);
  
  const mult = modoCalculo === 'anual' ? 1 : 12;
  
  const ingresoBrutoAnual = ingresoBruto * mult;
  const ingresoNetoAnual = ingresoBrutoAnual - (impuestos * mult) - (seguros * mult);
  const ahorroAnual = ahorro * mult;
  const pagoMensualDeuda = modoCalculo === 'anual' ? deudas / 12 : deudas;
  
  // Ratios
  const mesesReserva = gastosEsenciales > 0 ? reservaEmergencia / gastosEsenciales : 0;
  const tasaAhorro = ingresoBrutoAnual > 0 ? ahorroAnual / ingresoBrutoAnual : 0;
  const dtiNeto = (ingresoNetoAnual / 12) > 0 ? pagoMensualDeuda / (ingresoNetoAnual / 12) : 0;
  const deudaActivos = totales.activosTotales > 0 ? totales.pasivosTotales / totales.activosTotales : 0;
  const patrimonioActivos = totales.activosTotales > 0 ? totales.patrimonioNeto / totales.activosTotales : 0;
  const riquezaNeta = ingresoBrutoAnual > 0 ? totales.patrimonioNeto / ingresoBrutoAnual : 0;
  
  // Benchmark function
  const getRiquezaBenchmark = (age) => {
    const benchmarks = [
      {age:25, good:2.5, great:5},
      {age:30, good:3, great:6},
      {age:35, good:3.5, great:7},
      {age:40, good:4, great:8},
      {age:45, good:4.5, great:9},
      {age:50, good:5, great:10},
      {age:55, good:5.5, great:11},
      {age:60, good:6, great:12},
      {age:65, good:6.5, great:13},
      {age:70, good:7, great:14}
    ];
    
    if(age < 25) return benchmarks[0];
    if(age >= 70) return benchmarks[benchmarks.length-1];
    
    for(let i=0; i<benchmarks.length-1; i++) {
      if(age >= benchmarks[i].age && age < benchmarks[i+1].age) {
        const t = (age - benchmarks[i].age) / (benchmarks[i+1].age - benchmarks[i].age);
        return {
          good: benchmarks[i].good + t * (benchmarks[i+1].good - benchmarks[i].good),
          great: benchmarks[i].great + t * (benchmarks[i+1].great - benchmarks[i].great)
        };
      }
    }
    return benchmarks[benchmarks.length-1];
  };
  
  const edad = parseInt(userProfile.edad) || 30;
  const benchmark = getRiquezaBenchmark(edad);

  return (
    <div className="card">
      <div className="card-header">
        <div>
          <h2 className="card-title">ğŸ“Š Ratios Financieros</h2>
          <p className="card-subtitle">AnÃ¡lisis de tu salud financiera</p>
        </div>
      </div>

      <div style={{padding: '0 16px'}}>
        {/* LIQUIDEZ */}
        <div style={{margin: '24px 0 12px', padding: '8px 12px', background: 'var(--primary)', borderRadius: '10px', color: '#fff', fontSize: '14px', fontWeight: '700', textTransform: 'uppercase', letterSpacing: '.5px'}}>
          ğŸ’§ LIQUIDEZ
        </div>
        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '16px', marginBottom: '24px'}}>
          <div style={{background: 'white', borderRadius: '14px', padding: '16px', boxShadow: '0 2px 8px rgba(0,0,0,.08)'}}>
            <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '10px'}}>
              <div style={{fontSize: '15px', fontWeight: '600'}}>Meses de reserva</div>
              <button 
                onClick={() => setShowReservaModal(true)}
                style={{
                  display: 'inline-flex',
                  alignItems: 'center',
                  gap: '6px',
                  background: 'var(--primary)',
                  color: 'white',
                  padding: '4px 10px',
                  borderRadius: '6px',
                  fontSize: '12px',
                  fontWeight: '700',
                  textTransform: 'uppercase',
                  cursor: 'pointer',
                  border: 'none'
                }}
              >
                ğŸ’¡ Sugerencia
              </button>
            </div>
            <div style={{fontSize: '28px', fontWeight: '800', marginBottom: '8px'}}>
              {isFinite(mesesReserva) ? mesesReserva.toFixed(1) + ' m' : 'â€”'}
            </div>
            <div style={{fontSize: '15px', fontWeight: '600', marginBottom: '8px', color: mesesReserva >= 6 ? 'var(--success)' : mesesReserva >= 3 ? 'var(--warning)' : 'var(--danger)'}}>
              {mesesReserva >= 6 ? 'âœ…' : mesesReserva >= 3 ? 'âš ï¸' : 'ğŸš¨'}
            </div>
            <div style={{fontSize: '13px', color: 'var(--text-muted)', lineHeight: '1.4'}}>Meta: &gt;6 meses âœ…</div>
          </div>
        </div>

        {/* AHORRO */}
        <div style={{margin: '24px 0 12px', padding: '8px 12px', background: 'var(--primary)', borderRadius: '10px', color: '#fff', fontSize: '14px', fontWeight: '700', textTransform: 'uppercase', letterSpacing: '.5px'}}>
          ğŸ· AHORRO
        </div>
        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '16px', marginBottom: '24px'}}>
          <div style={{background: 'white', borderRadius: '14px', padding: '16px', boxShadow: '0 2px 8px rgba(0,0,0,.08)'}}>
            <div style={{fontSize: '15px', fontWeight: '600', marginBottom: '10px'}}>Tasa de ahorro</div>
            <div style={{fontSize: '28px', fontWeight: '800', marginBottom: '8px'}}>
              {isFinite(tasaAhorro) ? (tasaAhorro * 100).toFixed(1) + '%' : 'â€”'}
            </div>
            <div style={{fontSize: '15px', fontWeight: '600', marginBottom: '8px', color: tasaAhorro >= 0.30 ? 'var(--success)' : tasaAhorro >= 0.15 ? 'var(--warning)' : 'var(--danger)'}}>
              {tasaAhorro >= 0.30 ? 'âœ…' : tasaAhorro >= 0.15 ? 'âš ï¸' : 'ğŸš¨'}
            </div>
            <div style={{fontSize: '13px', color: 'var(--text-muted)', lineHeight: '1.4'}}>Meta: â‰¥30% âœ… Â· 15-29% âš ï¸ Â· &lt;15% ğŸš¨</div>
          </div>
        </div>

        {/* DEUDA */}
        <div style={{margin: '24px 0 12px', padding: '8px 12px', background: 'var(--primary)', borderRadius: '10px', color: '#fff', fontSize: '14px', fontWeight: '700', textTransform: 'uppercase', letterSpacing: '.5px'}}>
          ğŸ¦ DEUDA
        </div>
        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '16px', marginBottom: '24px'}}>
          <div style={{background: 'white', borderRadius: '14px', padding: '16px', boxShadow: '0 2px 8px rgba(0,0,0,.08)'}}>
            <div style={{fontSize: '15px', fontWeight: '600', marginBottom: '10px'}}>DTI neto</div>
            <div style={{fontSize: '28px', fontWeight: '800', marginBottom: '8px'}}>
              {isFinite(dtiNeto) ? (dtiNeto * 100).toFixed(1) + '%' : 'â€”'}
            </div>
            <div style={{fontSize: '15px', fontWeight: '600', marginBottom: '8px', color: dtiNeto <= 0.36 ? 'var(--success)' : 'var(--danger)'}}>
              {dtiNeto <= 0.36 ? 'âœ…' : 'ğŸš¨'}
            </div>
            <div style={{fontSize: '13px', color: 'var(--text-muted)', lineHeight: '1.4'}}>Meta: â‰¤36% âœ…</div>
          </div>

          <div style={{background: 'white', borderRadius: '14px', padding: '16px', boxShadow: '0 2px 8px rgba(0,0,0,.08)'}}>
            <div style={{fontSize: '15px', fontWeight: '600', marginBottom: '10px'}}>Pasivos / Activos</div>
            <div style={{fontSize: '28px', fontWeight: '800', marginBottom: '8px'}}>
              {isFinite(deudaActivos) ? (deudaActivos * 100).toFixed(1) + '%' : 'â€”'}
            </div>
            <div style={{fontSize: '15px', fontWeight: '600', marginBottom: '8px', color: deudaActivos > 0.50 ? 'var(--danger)' : deudaActivos >= 0.30 ? 'var(--warning)' : 'var(--success)'}}>
              {deudaActivos > 0.50 ? 'ğŸš¨' : deudaActivos >= 0.30 ? 'âš ï¸' : 'âœ…'}
            </div>
            <div style={{fontSize: '13px', color: 'var(--text-muted)', lineHeight: '1.4'}}>Meta: â‰¤30% âœ… Â· 30-50% âš ï¸ Â· &gt;50% ğŸš¨</div>
          </div>
        </div>

        {/* PATRIMONIO */}
        <div style={{margin: '24px 0 12px', padding: '8px 12px', background: 'var(--primary)', borderRadius: '10px', color: '#fff', fontSize: '14px', fontWeight: '700', textTransform: 'uppercase', letterSpacing: '.5px'}}>
          ğŸ’ PATRIMONIO
        </div>
        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '16px', marginBottom: '24px'}}>
          <div style={{background: 'white', borderRadius: '14px', padding: '16px', boxShadow: '0 2px 8px rgba(0,0,0,.08)'}}>
            <div style={{fontSize: '15px', fontWeight: '600', marginBottom: '10px'}}>Patrimonio / Activos</div>
            <div style={{fontSize: '28px', fontWeight: '800', marginBottom: '8px'}}>
              {isFinite(patrimonioActivos) ? (patrimonioActivos * 100).toFixed(1) + '%' : 'â€”'}
            </div>
            <div style={{fontSize: '15px', fontWeight: '600', marginBottom: '8px', color: patrimonioActivos >= 0.70 ? 'var(--success)' : patrimonioActivos >= 0.50 ? 'var(--warning)' : 'var(--danger)'}}>
              {patrimonioActivos >= 0.70 ? 'âœ…' : patrimonioActivos >= 0.50 ? 'âš ï¸' : 'ğŸš¨'}
            </div>
            <div style={{fontSize: '13px', color: 'var(--text-muted)', lineHeight: '1.4'}}>Meta: â‰¥70% âœ… Â· 50-69% âš ï¸ Â· &lt;50% ğŸš¨</div>
          </div>

          <div style={{background: 'white', borderRadius: '14px', padding: '16px', boxShadow: '0 2px 8px rgba(0,0,0,.08)'}}>
            <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '10px'}}>
              <div style={{fontSize: '15px', fontWeight: '600'}}>Nivel de riqueza neta</div>
              <button 
                onClick={() => setShowBenchmarkModal(true)}
                style={{
                  display: 'inline-flex',
                  alignItems: 'center',
                  gap: '6px',
                  background: 'var(--primary)',
                  color: 'white',
                  padding: '4px 10px',
                  borderRadius: '6px',
                  fontSize: '12px',
                  fontWeight: '700',
                  textTransform: 'uppercase',
                  cursor: 'pointer',
                  border: 'none'
                }}
              >
                ğŸ“Š Ver benchmark
              </button>
            </div>
            <div style={{fontSize: '28px', fontWeight: '800', marginBottom: '8px'}}>
              {isFinite(riquezaNeta) ? riquezaNeta.toFixed(2) + 'x' : 'â€”'}
            </div>
            <div style={{fontSize: '15px', fontWeight: '600', marginBottom: '8px', color: edad >= 18 && riquezaNeta >= benchmark.great ? 'var(--success)' : edad >= 18 && riquezaNeta >= benchmark.good ? 'var(--warning)' : 'var(--danger)'}}>
              {edad >= 18 && riquezaNeta >= benchmark.great ? 'âœ… Great' : edad >= 18 && riquezaNeta >= benchmark.good ? 'âš ï¸ Good' : 'ğŸš¨ Por debajo'}
            </div>
            <div style={{fontSize: '13px', color: 'var(--text-muted)', lineHeight: '1.4'}}>
              Tu edad: {edad} aÃ±os Â· Good: {benchmark.good.toFixed(1)}x Â· Great: {benchmark.great.toFixed(1)}x
            </div>
          </div>
        </div>
      </div>

      {/* Modal de Sugerencias de Reserva */}
      {showReservaModal && (
        <div style={{
          position: 'absolute',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0,0,0,0.7)',
          zIndex: 1001,
          display: 'flex',
          alignItems: 'flex-start',
          justifyContent: 'center',
          padding: '20px',
          paddingTop: '40px',
          backdropFilter: 'blur(8px)',
          overflowY: 'auto'
        }} onClick={() => setShowReservaModal(false)}>
          <div style={{
            background: '#fff',
            borderRadius: '20px',
            maxWidth: '900px',
            width: '100%',
            maxHeight: '90vh',
            overflow: 'hidden',
            display: 'flex',
            flexDirection: 'column',
            boxShadow: '0 25px 70px rgba(0,0,0,0.5)'
          }} onClick={(e) => e.stopPropagation()}>
            <div style={{padding: '20px 24px', background: 'var(--primary)', borderBottom: '1px solid var(--border)', display: 'flex', alignItems: 'center', justifyContent: 'space-between'}}>
              <div style={{fontSize: '22px', fontWeight: '800', color: 'white'}}>ğŸ’¡ Recomendaciones de Reserva de Emergencia</div>
              <button onClick={() => setShowReservaModal(false)} style={{background: 'rgba(255,255,255,0.2)', border: 'none', width: '32px', height: '32px', borderRadius: '50%', fontSize: '20px', cursor: 'pointer', color: 'white'}}>Ã—</button>
            </div>
            <div style={{padding: '32px', overflowY: 'auto'}}>
              <p style={{color: 'var(--text-muted)', marginBottom: '24px', lineHeight: '1.6', fontSize: '15px'}}>
                La cantidad ideal de meses de reserva depende de tu situaciÃ³n laboral y personal. Usa esta guÃ­a para determinar cuÃ¡nto necesitas:
              </p>
              
              <table style={{width: '100%', borderCollapse: 'collapse', background: '#fff', borderRadius: '12px', overflow: 'hidden'}}>
                <thead style={{background: 'var(--primary)', color: '#fff'}}>
                  <tr>
                    <th style={{padding: '14px 16px', textAlign: 'left', fontWeight: '700', fontSize: '14px', textTransform: 'uppercase', color: 'white'}}>Meses Recomendados</th>
                    <th style={{padding: '14px 16px', textAlign: 'left', fontWeight: '700', fontSize: '14px', textTransform: 'uppercase', color: 'white'}}>SituaciÃ³n</th>
                  </tr>
                </thead>
                <tbody>
                  <tr style={{borderBottom: '1px solid var(--border)'}}>
                    <td style={{padding: '16px', fontSize: '20px', fontWeight: '700', color: 'var(--success)'}}>6 meses</td>
                    <td style={{padding: '16px', fontSize: '15px', lineHeight: '1.6'}}>
                      <strong>Empleo estable + buena liquidez</strong>
                      <div style={{color: 'var(--text-muted)', fontSize: '14px', marginTop: '4px'}}>Trabajo seguro con historial sÃ³lido, sin dependientes mayores</div>
                    </td>
                  </tr>
                  <tr style={{borderBottom: '1px solid var(--border)'}}>
                    <td style={{padding: '16px', fontSize: '20px', fontWeight: '700', color: 'var(--success)'}}>9 meses</td>
                    <td style={{padding: '16px', fontSize: '15px', lineHeight: '1.6'}}>
                      <strong>Empleo estable + dependientes</strong>
                      <div style={{color: 'var(--text-muted)', fontSize: '14px', marginTop: '4px'}}>Trabajo seguro pero con familia o personas que dependen de ti</div>
                    </td>
                  </tr>
                  <tr style={{borderBottom: '1px solid var(--border)'}}>
                    <td style={{padding: '16px', fontSize: '20px', fontWeight: '700', color: 'var(--warning)'}}>12 meses</td>
                    <td style={{padding: '16px', fontSize: '15px', lineHeight: '1.6'}}>
                      <strong>Empleo inestable + dependientes</strong>
                      <div style={{color: 'var(--text-muted)', fontSize: '14px', marginTop: '4px'}}>Trabajo con menos estabilidad o industria volÃ¡til, con dependientes</div>
                    </td>
                  </tr>
                  <tr style={{borderBottom: '1px solid var(--border)'}}>
                    <td style={{padding: '16px', fontSize: '20px', fontWeight: '700', color: 'var(--warning)'}}>18 meses</td>
                    <td style={{padding: '16px', fontSize: '15px', lineHeight: '1.6'}}>
                      <strong>Ingresos variables (freelance)</strong>
                      <div style={{color: 'var(--text-muted)', fontSize: '14px', marginTop: '4px'}}>Trabajador independiente o consultor con ingresos que fluctÃºan mes a mes</div>
                    </td>
                  </tr>
                  <tr style={{borderBottom: '1px solid var(--border)'}}>
                    <td style={{padding: '16px', fontSize: '20px', fontWeight: '700', color: 'var(--danger)'}}>24 meses</td>
                    <td style={{padding: '16px', fontSize: '15px', lineHeight: '1.6'}}>
                      <strong>Negocio propio / alta volatilidad</strong>
                      <div style={{color: 'var(--text-muted)', fontSize: '14px', marginTop: '4px'}}>Emprendedor con negocio propio o ingresos muy variables</div>
                    </td>
                  </tr>
                  <tr>
                    <td style={{padding: '16px', fontSize: '20px', fontWeight: '700', color: 'var(--danger)'}}>36 meses</td>
                    <td style={{padding: '16px', fontSize: '15px', lineHeight: '1.6'}}>
                      <strong>Ingresos irregulares / pre-retiro</strong>
                      <div style={{color: 'var(--text-muted)', fontSize: '14px', marginTop: '4px'}}>Ingresos muy irregulares o estÃ¡s cerca del retiro y quieres mÃ¡s seguridad</div>
                    </td>
                  </tr>
                </tbody>
              </table>

              <div style={{background: '#f0f9ff', padding: '16px', borderRadius: '12px', borderLeft: '4px solid var(--primary)', marginTop: '24px'}}>
                <p style={{margin: 0, fontSize: '14px', lineHeight: '1.6', color: 'var(--text)'}}>
                  <strong>ğŸ’¡ Consejo:</strong> Tu reserva de emergencia debe cubrir tus gastos esenciales mensuales multiplicados por los meses recomendados segÃºn tu situaciÃ³n. Esta es tu red de seguridad ante imprevistos como pÃ©rdida de empleo, emergencias mÃ©dicas o reparaciones urgentes.
                </p>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Modal de Benchmarks */}
      {showBenchmarkModal && (
        <div style={{
          position: 'absolute',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0,0,0,0.7)',
          zIndex: 1001,
          display: 'flex',
          alignItems: 'flex-start',
          justifyContent: 'center',
          padding: '20px',
          paddingTop: '40px',
          backdropFilter: 'blur(8px)',
          overflowY: 'auto'
        }} onClick={() => setShowBenchmarkModal(false)}>
          <div style={{
            background: '#fff',
            borderRadius: '20px',
            maxWidth: '800px',
            width: '100%',
            maxHeight: '90vh',
            overflow: 'hidden',
            display: 'flex',
            flexDirection: 'column',
            boxShadow: '0 25px 70px rgba(0,0,0,0.5)'
          }} onClick={(e) => e.stopPropagation()}>
            <div style={{padding: '20px 24px', background: 'var(--primary)', borderBottom: '1px solid var(--border)', display: 'flex', alignItems: 'center', justifyContent: 'space-between'}}>
              <div style={{fontSize: '22px', fontWeight: '800', color: 'white'}}>ğŸ“Š Benchmarks de Nivel de Riqueza Neta</div>
              <button onClick={() => setShowBenchmarkModal(false)} style={{background: 'rgba(255,255,255,0.2)', border: 'none', width: '32px', height: '32px', borderRadius: '50%', fontSize: '20px', cursor: 'pointer', color: 'white'}}>Ã—</button>
            </div>
            <div style={{padding: '32px', overflowY: 'auto'}}>
              <p style={{color: 'var(--text-muted)', marginBottom: '24px', lineHeight: '1.6', fontSize: '15px'}}>
                Tu patrimonio neto como mÃºltiplo de tu ingreso bruto anual. Indica si estÃ¡s acumulando riqueza o solo sobreviviendo. Dos niveles: <strong>Good</strong> (âš ï¸) y <strong>Great</strong> (âœ…).
              </p>
              
              <table style={{width: '100%', borderCollapse: 'collapse', background: '#fff', borderRadius: '12px', overflow: 'hidden'}}>
                <thead style={{background: 'var(--primary)', color: '#fff'}}>
                  <tr>
                    <th style={{padding: '14px 16px', textAlign: 'left', fontWeight: '700', fontSize: '14px', color: 'white'}}>Edad</th>
                    <th style={{padding: '14px 16px', textAlign: 'left', fontWeight: '700', fontSize: '14px', color: 'white'}}>Good (âš ï¸)</th>
                    <th style={{padding: '14px 16px', textAlign: 'left', fontWeight: '700', fontSize: '14px', color: 'white'}}>Great (âœ…)</th>
                    <th style={{padding: '14px 16px', textAlign: 'left', fontWeight: '700', fontSize: '14px', color: 'white'}}>Ejemplo Great ({formatCurrency(50000, currency)})</th>
                  </tr>
                </thead>
                <tbody>
                  <tr style={{background: edad === 25 ? '#f0f9ff' : 'white', borderBottom: '1px solid var(--border)'}}>
                    <td style={{padding: '12px 16px'}}>25</td>
                    <td style={{padding: '12px 16px'}}>2.5x</td>
                    <td style={{padding: '12px 16px'}}>5.0x</td>
                    <td style={{padding: '12px 16px'}}>{formatCurrency(250000, currency)}</td>
                  </tr>
                  <tr style={{background: edad === 30 ? '#f0f9ff' : 'white', borderBottom: '1px solid var(--border)'}}>
                    <td style={{padding: '12px 16px'}}>30</td>
                    <td style={{padding: '12px 16px'}}>3.0x</td>
                    <td style={{padding: '12px 16px'}}>6.0x</td>
                    <td style={{padding: '12px 16px'}}>{formatCurrency(300000, currency)}</td>
                  </tr>
                  <tr style={{background: edad === 35 ? '#f0f9ff' : 'white', borderBottom: '1px solid var(--border)'}}>
                    <td style={{padding: '12px 16px'}}>35</td>
                    <td style={{padding: '12px 16px'}}>3.5x</td>
                    <td style={{padding: '12px 16px'}}>7.0x</td>
                    <td style={{padding: '12px 16px'}}>{formatCurrency(350000, currency)}</td>
                  </tr>
                  <tr style={{background: edad === 40 ? '#f0f9ff' : 'white', borderBottom: '1px solid var(--border)'}}>
                    <td style={{padding: '12px 16px'}}>40</td>
                    <td style={{padding: '12px 16px'}}>4.0x</td>
                    <td style={{padding: '12px 16px'}}>8.0x</td>
                    <td style={{padding: '12px 16px'}}>{formatCurrency(400000, currency)}</td>
                  </tr>
                  <tr style={{background: edad === 45 ? '#f0f9ff' : 'white', borderBottom: '1px solid var(--border)'}}>
                    <td style={{padding: '12px 16px'}}>45</td>
                    <td style={{padding: '12px 16px'}}>4.5x</td>
                    <td style={{padding: '12px 16px'}}>9.0x</td>
                    <td style={{padding: '12px 16px'}}>{formatCurrency(450000, currency)}</td>
                  </tr>
                  <tr style={{background: edad === 50 ? '#f0f9ff' : 'white', borderBottom: '1px solid var(--border)'}}>
                    <td style={{padding: '12px 16px'}}>50</td>
                    <td style={{padding: '12px 16px'}}>5.0x</td>
                    <td style={{padding: '12px 16px'}}>10.0x</td>
                    <td style={{padding: '12px 16px'}}>{formatCurrency(500000, currency)}</td>
                  </tr>
                  <tr style={{background: edad === 55 ? '#f0f9ff' : 'white', borderBottom: '1px solid var(--border)'}}>
                    <td style={{padding: '12px 16px'}}>55</td>
                    <td style={{padding: '12px 16px'}}>5.5x</td>
                    <td style={{padding: '12px 16px'}}>11.0x</td>
                    <td style={{padding: '12px 16px'}}>{formatCurrency(550000, currency)}</td>
                  </tr>
                  <tr style={{background: edad === 60 ? '#f0f9ff' : 'white', borderBottom: '1px solid var(--border)'}}>
                    <td style={{padding: '12px 16px'}}>60</td>
                    <td style={{padding: '12px 16px'}}>6.0x</td>
                    <td style={{padding: '12px 16px'}}>12.0x</td>
                    <td style={{padding: '12px 16px'}}>{formatCurrency(600000, currency)}</td>
                  </tr>
                  <tr style={{background: edad === 65 ? '#f0f9ff' : 'white', borderBottom: '1px solid var(--border)'}}>
                    <td style={{padding: '12px 16px'}}>65</td>
                    <td style={{padding: '12px 16px'}}>6.5x</td>
                    <td style={{padding: '12px 16px'}}>13.0x</td>
                    <td style={{padding: '12px 16px'}}>{formatCurrency(650000, currency)}</td>
                  </tr>
                  <tr style={{background: edad === 70 ? '#f0f9ff' : 'white'}}>
                    <td style={{padding: '12px 16px'}}>70</td>
                    <td style={{padding: '12px 16px'}}>7.0x</td>
                    <td style={{padding: '12px 16px'}}>14.0x</td>
                    <td style={{padding: '12px 16px'}}>{formatCurrency(700000, currency)}</td>
                  </tr>
                </tbody>
              </table>

              <div style={{background: '#f8fafc', padding: '16px', borderRadius: '12px', borderLeft: '4px solid var(--emerald)', marginTop: '24px'}}>
                <p style={{margin: 0, fontSize: '14px', lineHeight: '1.6', color: 'var(--text)'}}>
                  <strong>Nota:</strong> Estos benchmarks son guÃ­as generales. Tu situaciÃ³n personal puede variar segÃºn tus metas, estilo de vida esperado, y otras fuentes de ingreso. Se calcula: <strong>Patrimonio Neto Ã· Ingreso Bruto Anual</strong>
                </p>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
// ============= ENVIAR DATOS AL PARENT (CARD) =============
function DataSync({ totales, userProfile, currency, ingresoBruto, ahorro, deudas, gastosEsenciales, reservaEmergencia, pagoMensualDeudas, modoCalculo, impuestos, seguros }) {
  useEffect(() => {
    // Solo enviar si estamos en un iframe
    if (window.parent !== window) {
      const dataToSend = {
        type: 'MONEY_MAP_DATA',
        data: {
          totales: {
            activosTotales: totales.activosTotales,
            pasivosTotales: totales.pasivosTotales,
            patrimonioNeto: totales.patrimonioNeto
          },
          userProfile: {
            nombre: userProfile.nombre,
            apellido: userProfile.apellido,
            edad: userProfile.edad,
            impuestos: parseNumber(impuestos),
            seguros: parseNumber(seguros)
          },
          currency,
          ingresoBruto: parseNumber(ingresoBruto),
          ahorro: parseNumber(ahorro),
          deudas: parseNumber(deudas),
          gastosEsenciales: parseNumber(gastosEsenciales),
          reservaEmergencia: parseNumber(reservaEmergencia),
          pagoMensualDeudas: parseNumber(pagoMensualDeudas),
          modoCalculo
        }
      };
      
      // Enviar mensaje al parent
      window.parent.postMessage(dataToSend, '*');
    }
  }, [totales, userProfile, currency, ingresoBruto, ahorro, deudas, gastosEsenciales, reservaEmergencia, pagoMensualDeudas, modoCalculo, impuestos, seguros]);

  return null;
}
ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
